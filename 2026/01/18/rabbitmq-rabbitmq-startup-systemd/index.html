<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.svg">
  <link rel="mask-icon" href="/images/favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Noto+Serif+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Source+Code+Pro:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hzsunzixiang.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.27.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"default","show_result":true},"fold":{"enable":false,"height":500},"language":false,"highlight_theme":"default"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":true,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="RabbitMQ 启动方式与 Systemd 集成详解目标以 RabbitMQ version: 3.9.21 版本为例  systemd 的使用方式(shell、c、python、erlang) RabbitMQ 的启动方式 systemd 库的源码分析 RabbitMQ 的启动脚本  123export ERL_LIBS&#x3D;&#x2F;usr&#x2F;lib&#x2F;rabbitmq&#x2F;lib&#x2F;rabbitmq_serve">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMQ 启动方式与 Systemd 集成详解">
<meta property="og:url" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/">
<meta property="og:site_name" content="Zixiang Sun&#39;s Blog">
<meta property="og:description" content="RabbitMQ 启动方式与 Systemd 集成详解目标以 RabbitMQ version: 3.9.21 版本为例  systemd 的使用方式(shell、c、python、erlang) RabbitMQ 的启动方式 systemd 库的源码分析 RabbitMQ 的启动脚本  123export ERL_LIBS&#x3D;&#x2F;usr&#x2F;lib&#x2F;rabbitmq&#x2F;lib&#x2F;rabbitmq_serve">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image2.svg">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image3.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image4.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image5.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image6.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image7.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image8.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image7.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image9.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image10.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image11.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image12.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image13.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image14.png">
<meta property="og:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image15.png">
<meta property="article:published_time" content="2026-01-17T16:00:00.000Z">
<meta property="article:modified_time" content="2026-01-18T04:42:21.831Z">
<meta property="article:author" content="Zixiang Sun">
<meta property="article:tag" content="Erlang">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="RabbitMQ">
<meta property="article:tag" content="Systemd">
<meta property="article:tag" content="服务管理">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image2.svg">


<link rel="canonical" href="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/","path":"2026/01/18/rabbitmq-rabbitmq-startup-systemd/","title":"RabbitMQ 启动方式与 Systemd 集成详解"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>RabbitMQ 启动方式与 Systemd 集成详解 | Zixiang Sun's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Zixiang Sun's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Zixiang Sun's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Sharing thoughts on technology, programming, and life</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">17</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">9</span></a></li><li class="menu-item menu-item-erlang"><a href="/erlang/" rel="section"><i class="fa fa-code fa-fw"></i>Erlang</a></li><li class="menu-item menu-item-rabbitmq"><a href="/rabbitmq/" rel="section"><i class="fa fa-server fa-fw"></i>RabbitMQ</a></li><li class="menu-item menu-item-craq"><a href="/craq/" rel="section"><i class="fa fa-book fa-fw"></i>CRAQ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#RabbitMQ-%E5%90%AF%E5%8A%A8%E6%96%B9%E5%BC%8F%E4%B8%8E-Systemd-%E9%9B%86%E6%88%90%E8%AF%A6%E8%A7%A3"><span class="nav-number">1.</span> <span class="nav-text">RabbitMQ 启动方式与 Systemd 集成详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">1.1.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#systemd-%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD"><span class="nav-number">1.2.</span> <span class="nav-text">systemd 相关术语</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AF%E8%AF%AD%E8%A7%A3%E9%87%8A"><span class="nav-number">1.2.1.</span> <span class="nav-text">术语解释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="nav-number">1.2.2.</span> <span class="nav-text">实例演示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-helloworld-sh"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">应用程序 (helloworld.sh)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service-%E9%85%8D%E7%BD%AE-helloworld-service"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">Service 配置 (helloworld.service)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E6%BC%94%E7%A4%BA"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">流程演示</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84-systemd"><span class="nav-number">1.3.</span> <span class="nav-text">C 语言中的 systemd</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python-%E4%B8%AD%E7%9A%84-systemd"><span class="nav-number">1.4.</span> <span class="nav-text">Python 中的 systemd</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Erlang-%E4%B8%AD%E7%9A%84-systemd"><span class="nav-number">1.5.</span> <span class="nav-text">Erlang 中的 systemd</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.5.1.</span> <span class="nav-text">启动示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#erlang-systemd-%E5%BA%93%E7%89%B9%E7%82%B9"><span class="nav-number">1.5.2.</span> <span class="nav-text">erlang-systemd 库特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Socket-%E5%A4%84%E7%90%86%E4%BB%A3%E7%A0%81"><span class="nav-number">1.5.3.</span> <span class="nav-text">Socket 处理代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E-READY-%E9%80%9A%E7%9F%A5%E7%9A%84%E9%87%8D%E8%A6%81%E8%AF%B4%E6%98%8E"><span class="nav-number">1.5.4.</span> <span class="nav-text">关于 READY 通知的重要说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#systemd-%E5%9C%A8-RabbitMQ-%E5%90%AF%E5%8A%A8%E4%B8%AD%E7%9A%84%E5%85%B7%E4%BD%93%E4%BD%9C%E7%94%A8"><span class="nav-number">1.6.</span> <span class="nav-text">systemd 在 RabbitMQ 启动中的具体作用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-RabbitMQ"><span class="nav-number">1.6.1.</span> <span class="nav-text">安装 RabbitMQ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-yum-%E6%BA%90"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">配置 yum 源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%91%BD%E4%BB%A4"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">安装命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB"><span class="nav-number">1.6.1.3.</span> <span class="nav-text">设置日志级别</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E5%88%AB%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%9F%9F%E5%90%8D%E9%85%8D%E7%BD%AE"><span class="nav-number">1.6.2.</span> <span class="nav-text">特别注意：域名配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RabbitMQ-Service-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.6.3.</span> <span class="nav-text">RabbitMQ Service 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E7%8A%B6%E6%80%81%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.6.4.</span> <span class="nav-text">启动状态示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AF%B4%E6%98%8E"><span class="nav-number">1.6.5.</span> <span class="nav-text">环境变量说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E7%8A%B6%E6%80%81%E6%97%A5%E5%BF%97"><span class="nav-number">1.6.6.</span> <span class="nav-text">启动状态日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#systemd-%E7%8A%B6%E6%80%81%E9%80%9A%E7%9F%A5%E6%97%A5%E5%BF%97"><span class="nav-number">1.6.7.</span> <span class="nav-text">systemd 状态通知日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Shell-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%94%A8%E6%B3%95%E8%A1%A5%E5%85%85"><span class="nav-number">1.7.</span> <span class="nav-text">Shell 的一些用法补充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#set-e"><span class="nav-number">1.7.1.</span> <span class="nav-text">set -e</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E6%B5%8B-systemd-%E7%8E%AF%E5%A2%83"><span class="nav-number">1.7.2.</span> <span class="nav-text">检测 systemd 环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#systemd-notify-%E5%91%BD%E4%BB%A4%E5%B8%AE%E5%8A%A9"><span class="nav-number">1.7.3.</span> <span class="nav-text">systemd-notify 命令帮助</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.8.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zixiang Sun"
      src="/images/avatar.svg">
  <p class="site-author-name" itemprop="name">Zixiang Sun</p>
  <div class="site-description" itemprop="description">Welcome to my personal blog where I share thoughts on technology, programming, and life experiences.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/hzsunzixiang" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hzsunzixiang" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:17842379@qq.com" title="E-Mail → mailto:17842379@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hzsunzixiang.github.io/2026/01/18/rabbitmq-rabbitmq-startup-systemd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.svg">
      <meta itemprop="name" content="Zixiang Sun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zixiang Sun's Blog">
      <meta itemprop="description" content="Welcome to my personal blog where I share thoughts on technology, programming, and life experiences.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="RabbitMQ 启动方式与 Systemd 集成详解 | Zixiang Sun's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RabbitMQ 启动方式与 Systemd 集成详解
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2026-01-18 00:00:00 / 修改时间：12:42:21" itemprop="dateCreated datePublished" datetime="2026-01-18T00:00:00+08:00">2026-01-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/RabbitMQ/" itemprop="url" rel="index"><span itemprop="name">RabbitMQ</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="RabbitMQ-启动方式与-Systemd-集成详解"><a href="#RabbitMQ-启动方式与-Systemd-集成详解" class="headerlink" title="RabbitMQ 启动方式与 Systemd 集成详解"></a>RabbitMQ 启动方式与 Systemd 集成详解</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p><strong>以 RabbitMQ version: 3.9.21 版本为例</strong></p>
<ul>
<li><strong>systemd 的使用方式(shell、c、python、erlang)</strong></li>
<li><strong>RabbitMQ 的启动方式</strong></li>
<li><strong>systemd 库的源码分析</strong></li>
<li><strong>RabbitMQ 的启动脚本</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ERL_LIBS=/usr/lib/rabbitmq/lib/rabbitmq_server-3.9.21/plugins</span><br><span class="line"></span><br><span class="line">ERL_LIBS=/usr/lib/rabbitmq/lib/rabbitmq_server-3.9.21/plugins erl -noinput -s rabbit boot -boot start_sasl</span><br></pre></td></tr></table></figure>

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image2.svg" class="" title="RabbitMQ 启动架构图">

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image3.png" class="" title="启动流程">

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image4.png" class="" title="详细启动过程">

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image5.png" class="" title="启动状态">

<hr>
<h2 id="systemd-相关术语"><a href="#systemd-相关术语" class="headerlink" title="systemd 相关术语"></a>systemd 相关术语</h2><h3 id="术语解释"><a href="#术语解释" class="headerlink" title="术语解释"></a>术语解释</h3><table>
<thead>
<tr>
<th><strong>术语</strong></th>
<th><strong>英文对照</strong></th>
<th><strong>备注</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>应用程序</strong></td>
<td>service script(App)</td>
<td></td>
</tr>
<tr>
<td><strong>服务名</strong></td>
<td>service</td>
<td></td>
</tr>
<tr>
<td><strong>服务管理器</strong></td>
<td>systemd</td>
<td>系统和服务管理器</td>
</tr>
<tr>
<td><strong>服务管理命令</strong></td>
<td>systemctl</td>
<td>与 systemd 进行交互的接口</td>
</tr>
</tbody></table>
<p>应用程序启动一般需要一定的启动时间才能初始化完毕，初始化完毕的时候可以通过某种方式通知服务管理器。</p>
<p><code>systemd-notify</code> 就是用来向服务管理器(systemd)<strong>通知启动完成</strong>及其他守护进程状态变化。</p>
<p><code>systemd-notify</code> 是 <code>sd_notify()</code> 函数的一个包装，使得 shell 脚本也能使用此功能。</p>
<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image6.png" class="" title="systemd-notify 工作流程">

<h3 id="实例演示"><a href="#实例演示" class="headerlink" title="实例演示"></a>实例演示</h3><table>
<thead>
<tr>
<th><strong>术语</strong></th>
<th><strong>英文对照</strong></th>
<th><strong>备注</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>应用程序</strong></td>
<td>service script(App)</td>
<td>helloworld.sh</td>
</tr>
<tr>
<td><strong>服务名</strong></td>
<td>service name</td>
<td>helloworld.service</td>
</tr>
<tr>
<td><strong>服务管理器</strong></td>
<td>systemd</td>
<td>系统和服务管理器</td>
</tr>
<tr>
<td><strong>服务管理命令</strong></td>
<td>systemctl</td>
<td>与 systemd 进行交互的接口</td>
</tr>
</tbody></table>
<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image7.png" class="" title="实例演示架构">

<p><strong>示例代码：</strong> <a target="_blank" rel="noopener" href="https://github.com/hzsunzixiang/rabbitmq-server-debug/tree/main/book/systemd">https://github.com/hzsunzixiang/rabbitmq-server-debug/tree/main/book/systemd</a></p>
<h4 id="应用程序-helloworld-sh"><a href="#应用程序-helloworld-sh" class="headerlink" title="应用程序 (helloworld.sh)"></a>应用程序 (helloworld.sh)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">systemd-notify --ready --status=<span class="string">&quot;Waiting for data ...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> : ; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;...NOTIFY_SOCKET:[ <span class="variable">$NOTIFY_SOCKET</span> ]...&quot;</span> &gt; /tmp/notify.txt</span><br><span class="line">    systemd-notify --status=<span class="string">&quot;do something hello...&quot;</span></span><br><span class="line">    <span class="comment"># Do something with</span></span><br><span class="line">    <span class="built_in">sleep</span> 10</span><br><span class="line">    systemd-notify --status=<span class="string">&quot;do something world...&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h4 id="Service-配置-helloworld-service"><a href="#Service-配置-helloworld-service" class="headerlink" title="Service 配置 (helloworld.service)"></a>Service 配置 (helloworld.service)</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=HelloWorld Service</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=notify</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/bin/helloworld.sh</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>

<h4 id="流程演示"><a href="#流程演示" class="headerlink" title="流程演示"></a>流程演示</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl start helloworld</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;helloworld&quot;</span> &gt; /tmp/helloworld</span><br><span class="line">systemctl status helloworld</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="C-语言中的-systemd"><a href="#C-语言中的-systemd" class="headerlink" title="C 语言中的 systemd"></a>C 语言中的 systemd</h2><p>示例代码：<a target="_blank" rel="noopener" href="https://github.com/hzsunzixiang/rabbitmq-server-debug/tree/main/book/systemd/clang_systemd">https://github.com/hzsunzixiang/rabbitmq-server-debug/tree/main/book/systemd/clang_systemd</a></p>
<hr>
<h2 id="Python-中的-systemd"><a href="#Python-中的-systemd" class="headerlink" title="Python 中的 systemd"></a>Python 中的 systemd</h2><p>示例代码：<a target="_blank" rel="noopener" href="https://github.com/hzsunzixiang/rabbitmq-server-debug/tree/main/book/systemd/python_systemd">https://github.com/hzsunzixiang/rabbitmq-server-debug/tree/main/book/systemd/python_systemd</a></p>
<hr>
<h2 id="Erlang-中的-systemd"><a href="#Erlang-中的-systemd" class="headerlink" title="Erlang 中的 systemd"></a>Erlang 中的 systemd</h2><p><strong>注意：</strong> 需要设置 <code>NotifyAccess=all</code></p>
<h3 id="启动示例"><a href="#启动示例" class="headerlink" title="启动示例"></a>启动示例</h3><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">application:ensure_all_started(systemd).</span><br><span class="line">&#123;ok,[enough,systemd]&#125;</span><br></pre></td></tr></table></figure>

<p>或者从 <code>rebar.config</code> 中配置依赖：</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;deps, [enough]&#125;.</span><br></pre></td></tr></table></figure>

<h3 id="erlang-systemd-库特点"><a href="#erlang-systemd-库特点" class="headerlink" title="erlang-systemd 库特点"></a>erlang-systemd 库特点</h3><p>erlang-systemd 是一个 Erlang 库，用于在 Erlang 应用程序中集成 systemd。主要特点包括：</p>
<ol>
<li>支持 systemd 的所有通知类型，包括 READY、STATUS、WATCHDOG 等</li>
<li>支持 systemd 的所有进程管理功能，包括启动、停止、重启、暂停、恢复等</li>
<li>支持 systemd 的所有 unit 管理功能，包括注册、卸载、状态查询等</li>
<li>支持 systemd 的所有进程间通信功能，包括 socket 激活、文件描述符传递等</li>
<li>提供了一组方便的宏和函数，简化与 systemd 的交互过程</li>
</ol>
<h3 id="Socket-处理代码"><a href="#Socket-处理代码" class="headerlink" title="Socket 处理代码"></a>Socket 处理代码</h3><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">os:putenv(<span class="string">&quot;NOTIFY_SOCKET&quot;</span>, <span class="string">&quot;/run/systemd/notify&quot;</span>).</span><br><span class="line">os:getenv(<span class="string">&quot;NOTIFY_SOCKET&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">notify_socket</span><span class="params">()</span> -&gt;</span></span><br><span class="line">    State =</span><br><span class="line">        <span class="keyword">case</span> os:getenv(?NOTIFY_SOCKET) <span class="keyword">of</span></span><br><span class="line">            <span class="literal">false</span> -&gt;</span><br><span class="line">                [];</span><br><span class="line">            [<span class="string">$@</span> | AbstractPath] -&gt;</span><br><span class="line">                [<span class="number">0</span> | AbstractPath];</span><br><span class="line">            Path -&gt;</span><br><span class="line">                <span class="keyword">case</span> file:read_file_info(Path) <span class="keyword">of</span></span><br><span class="line">                    &#123;error, _Error&#125; -&gt;</span><br><span class="line">                        [];</span><br><span class="line">                    &#123;ok, #file_info&#123;access = Access&#125;&#125; <span class="keyword">when</span></span><br><span class="line">                        Access =:= write; Access =:= read_write</span><br><span class="line">                    -&gt;</span><br><span class="line">                        Path</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span>,</span><br><span class="line">    unset(notify),</span><br><span class="line">    State.</span><br></pre></td></tr></table></figure>

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image8.png" class="" title="Erlang systemd 集成">

<h3 id="关于-READY-通知的重要说明"><a href="#关于-READY-通知的重要说明" class="headerlink" title="关于 READY 通知的重要说明"></a>关于 READY 通知的重要说明</h3><p><strong>如果不发送 READY 通知会怎样？</strong></p>
<p>如果应用程序没有向 systemd 发送 READY 通知，systemd 会默认认为应用程序已经准备就绪，并开始接收请求。这种情况下，systemd 不会等待应用程序发送 READY 通知，而是直接将该进程标记为已就绪状态。</p>
<p><strong>使用 Type&#x3D;notify 的情况：</strong></p>
<p>如果应用程序没有 READY 通知机制，可以使用 systemd 的 <code>Type=notify</code> 选项，以便 systemd 等待应用程序发送 READY 通知。在这种情况下，systemd 会在启动应用程序时，将一条文件描述符（socket）传递给应用程序，应用程序可以使用该文件描述符向 systemd 发送 READY 通知。如果应用程序不发送 READY 通知，systemd 会超时并将该进程标记为启动失败。</p>
<hr>
<h2 id="systemd-在-RabbitMQ-启动中的具体作用"><a href="#systemd-在-RabbitMQ-启动中的具体作用" class="headerlink" title="systemd 在 RabbitMQ 启动中的具体作用"></a>systemd 在 RabbitMQ 启动中的具体作用</h2><img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image7.png" class="" title="RabbitMQ systemd 集成架构">

<h3 id="安装-RabbitMQ"><a href="#安装-RabbitMQ" class="headerlink" title="安装 RabbitMQ"></a>安装 RabbitMQ</h3><h4 id="配置-yum-源"><a href="#配置-yum-源" class="headerlink" title="配置 yum 源"></a>配置 yum 源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/yum.repos.d/CentOS-Messaging-rabbitmq.repo</span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[centos-rabbitmq-38]</span></span><br><span class="line"><span class="attr">name</span>=CentOS-<span class="number">9</span> - RabbitMQ <span class="number">38</span></span><br><span class="line"><span class="attr">metalink</span>=https://mirrors.centos.org/metalink?repo=centos-messaging-sig-rabbitmq-<span class="number">38</span>-<span class="variable">$releasever</span>-stream&amp;arch=<span class="variable">$basearch</span>&amp;protocol=https,http</span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">gpgkey</span>=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-Messaging</span><br></pre></td></tr></table></figure>

<h4 id="安装命令"><a href="#安装命令" class="headerlink" title="安装命令"></a>安装命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 yum 源</span></span><br><span class="line">yum install centos-release-rabbitmq-38.noarch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 rabbitmq</span></span><br><span class="line">yum install rabbitmq-server.aarch64</span><br></pre></td></tr></table></figure>

<h4 id="设置日志级别"><a href="#设置日志级别" class="headerlink" title="设置日志级别"></a>设置日志级别</h4><p>在 <code>/etc/rabbitmq/rabbitmq.conf</code> 中添加：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log.file.level</span> = debug</span><br></pre></td></tr></table></figure>

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image9.png" class="" title="日志配置">

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image10.png" class="" title="启动日志">

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image11.png" class="" title="详细日志">

<h3 id="特别注意：域名配置"><a href="#特别注意：域名配置" class="headerlink" title="特别注意：域名配置"></a>特别注意：域名配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/hosts</span><br></pre></td></tr></table></figure>

<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"><span class="number">127.0.0.1</span>   rabbitmq</span><br><span class="line"><span class="number">172.16.117.156</span>  rabbitmq</span><br></pre></td></tr></table></figure>

<p><strong>如果域名配置不正确，会出现以下错误：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br><span class="line"><span class="comment"># &#123;:query, :rabbit@rabbitmq, &#123;:badrpc, :timeout&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">rabbitmqctl status</span><br><span class="line"><span class="comment"># Error: unable to perform an operation on node &#x27;rabbit@rabbitmq&#x27;.</span></span><br></pre></td></tr></table></figure>

<h3 id="RabbitMQ-Service-配置文件"><a href="#RabbitMQ-Service-配置文件" class="headerlink" title="RabbitMQ Service 配置文件"></a>RabbitMQ Service 配置文件</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemd unit example</span></span><br><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=RabbitMQ broker</span><br><span class="line"><span class="attr">After</span>=network.target epmd@<span class="number">0.0</span>.<span class="number">0.0</span>.socket</span><br><span class="line"><span class="attr">Wants</span>=network.target epmd@<span class="number">0.0</span>.<span class="number">0.0</span>.socket</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="comment"># 安全加固选项（可选）</span></span><br><span class="line"><span class="comment"># ProtectSystem=full</span></span><br><span class="line"><span class="comment"># ProtectHome=true</span></span><br><span class="line"><span class="comment"># PrivateDevices=true</span></span><br><span class="line"><span class="comment"># ProtectHostname=true</span></span><br><span class="line"><span class="comment"># ProtectClock=true</span></span><br><span class="line"><span class="comment"># ProtectKernelTunables=true</span></span><br><span class="line"><span class="comment"># ProtectKernelModules=true</span></span><br><span class="line"><span class="comment"># ProtectKernelLogs=true</span></span><br><span class="line"><span class="comment"># ProtectControlGroups=true</span></span><br><span class="line"><span class="comment"># RestrictRealtime=true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Type</span>=notify</span><br><span class="line"><span class="attr">User</span>=rabbitmq</span><br><span class="line"><span class="attr">Group</span>=rabbitmq</span><br><span class="line"><span class="attr">NotifyAccess</span>=all</span><br><span class="line"><span class="attr">TimeoutStartSec</span>=<span class="number">3600</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动重启配置（可选）</span></span><br><span class="line"><span class="comment"># Restart=on-failure</span></span><br><span class="line"><span class="comment"># RestartSec=10</span></span><br><span class="line"></span><br><span class="line"><span class="attr">WorkingDirectory</span>=/var/lib/rabbitmq</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/lib/rabbitmq/bin/rabbitmq-server</span><br><span class="line"><span class="attr">ExecStop</span>=/usr/lib/rabbitmq/bin/rabbitmqctl stop</span><br><span class="line"><span class="attr">ExecStop</span>=/bin/sh -c <span class="string">&quot;while ps -p $MAINPID &gt;/dev/null 2&gt;&amp;1; do sleep 1; done&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>

<h3 id="启动状态示例"><a href="#启动状态示例" class="headerlink" title="启动状态示例"></a>启动状态示例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status rabbitmq-server</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">● rabbitmq-server.service - RabbitMQ broker</span><br><span class="line"><span class="symbol">   Loaded:</span> loaded (<span class="keyword">/etc/</span>systemd<span class="keyword">/system/</span>rabbitmq-server.<span class="attr">service</span><span class="punctuation">;</span> <span class="attr">disabled</span><span class="punctuation">;</span> preset: disabled)</span><br><span class="line"><span class="symbol">   Active:</span> active (running) since Sat <span class="number">2025</span><span class="number">-01</span><span class="number">-04</span> <span class="number">01</span>:<span class="number">10</span>:<span class="number">28</span> EST<span class="punctuation">;</span> <span class="number">39</span>s ago</span><br><span class="line"> Main PID: <span class="number">164224</span> (beam.smp)</span><br><span class="line"><span class="symbol">    Tasks:</span> <span class="number">27</span> (limit: <span class="number">22563</span>)</span><br><span class="line"><span class="symbol">   Memory:</span> <span class="number">124.8</span>M</span><br><span class="line"><span class="symbol">      CPU:</span> <span class="number">5.890</span>s</span><br><span class="line"><span class="symbol">   CGroup:</span> /system.slice/rabbitmq-server.service</span><br><span class="line">           ├─<span class="number">164224</span> <span class="keyword">/usr/</span>local<span class="keyword">/lib/</span>erlang/erts<span class="number">-14.2</span><span class="number">.5</span><span class="number">.1</span><span class="keyword">/bin/</span>beam.smp ...</span><br><span class="line">           ├─<span class="number">164235</span> erl_child_setup <span class="number">1024</span></span><br><span class="line">           ├─<span class="number">164294</span> <span class="keyword">/usr/</span>local<span class="keyword">/lib/</span>erlang/erts<span class="number">-14.2</span><span class="number">.5</span><span class="number">.1</span><span class="keyword">/bin/</span>inet_gethost <span class="number">4</span></span><br><span class="line">           └─<span class="number">164295</span> <span class="keyword">/usr/</span>local<span class="keyword">/lib/</span>erlang/erts<span class="number">-14.2</span><span class="number">.5</span><span class="number">.1</span><span class="keyword">/bin/</span>inet_gethost <span class="number">4</span></span><br></pre></td></tr></table></figure>

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image12.png" class="" title="服务状态">

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image13.png" class="" title="详细状态">

<h3 id="环境变量说明"><a href="#环境变量说明" class="headerlink" title="环境变量说明"></a>环境变量说明</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">NOTIFY_SOCKET</span><span class="symbol">:/run/systemd/notify</span></span><br><span class="line"><span class="variable constant_">RABBITMQ_ALLOW_INPUT</span><span class="symbol">:</span>, <span class="variable constant_">RUNNING_UNDER_SYSTEMD</span><span class="symbol">:true</span> <span class="symbol">detached:</span></span><br></pre></td></tr></table></figure>

<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image14.png" class="" title="环境变量">

<h3 id="启动状态日志"><a href="#启动状态日志" class="headerlink" title="启动状态日志"></a>启动状态日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&quot;Change boot state to&quot;</span> /var/log/rabbitmq/*</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/var/<span class="keyword">log</span>/rabbitmq/rabbit@rabbitmq.<span class="keyword">log</span>:<span class="number">2025</span>-<span class="number">01</span>-<span class="number">04</span> <span class="number">07</span>:<span class="number">59</span>:<span class="number">46.747822</span>-<span class="number">05</span>:<span class="number">00</span> [<span class="keyword">debug</span>] <span class="variable">&lt;0.237.0&gt;</span> Change boot <span class="keyword">state</span> <span class="keyword">to</span> `core_started`</span><br><span class="line">/var/<span class="keyword">log</span>/rabbitmq/rabbit@rabbitmq.<span class="keyword">log</span>:<span class="number">2025</span>-<span class="number">01</span>-<span class="number">04</span> <span class="number">07</span>:<span class="number">59</span>:<span class="number">46.898118</span>-<span class="number">05</span>:<span class="number">00</span> [<span class="keyword">debug</span>] <span class="variable">&lt;0.477.0&gt;</span> Change boot <span class="keyword">state</span> <span class="keyword">to</span> `ready`</span><br></pre></td></tr></table></figure>

<h3 id="systemd-状态通知日志"><a href="#systemd-状态通知日志" class="headerlink" title="systemd 状态通知日志"></a>systemd 状态通知日志</h3><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2025</span>-<span class="number">01</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">20</span>:<span class="number">19.415916</span>+<span class="number">08</span>:<span class="number">00</span> [<span class="keyword">debug</span>] <span class="variable">&lt;0.132.0&gt;</span> Boot <span class="keyword">state</span>/systemd: sending non-systemd <span class="keyword">state</span> (stopped) as status description: <span class="string">&quot;Standing by&quot;</span></span><br><span class="line"><span class="number">2025</span>-<span class="number">01</span>-<span class="number">22</span> <span class="number">14</span>:<span class="number">59</span>:<span class="number">40.525333</span>+<span class="number">08</span>:<span class="number">00</span> [<span class="keyword">debug</span>] <span class="variable">&lt;0.132.0&gt;</span> Boot <span class="keyword">state</span>/systemd: sending non-systemd <span class="keyword">state</span> (core_started) as status description: <span class="string">&quot;Startup in progress (core ready, starting plugins)&quot;</span></span><br><span class="line"><span class="number">2025</span>-<span class="number">01</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">50.174236</span>+<span class="number">08</span>:<span class="number">00</span> [<span class="keyword">debug</span>] <span class="variable">&lt;0.132.0&gt;</span> Boot <span class="keyword">state</span>/systemd: sending non-systemd <span class="keyword">state</span> (stopping) as status description: <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">2025</span>-<span class="number">01</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">55.186351</span>+<span class="number">08</span>:<span class="number">00</span> [<span class="keyword">debug</span>] <span class="variable">&lt;0.132.0&gt;</span> Boot <span class="keyword">state</span>/systemd: sending non-systemd <span class="keyword">state</span> (stopped) as status description: <span class="string">&quot;Standing by&quot;</span></span><br><span class="line"><span class="number">2025</span>-<span class="number">01</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">59.650639</span>+<span class="number">08</span>:<span class="number">00</span> [<span class="keyword">debug</span>] <span class="variable">&lt;0.132.0&gt;</span> Boot <span class="keyword">state</span>/systemd: sending non-systemd <span class="keyword">state</span> (core_started) as status description: <span class="string">&quot;Startup in progress (core ready, starting plugins)&quot;</span></span><br><span class="line"><span class="number">2025</span>-<span class="number">01</span>-<span class="number">22</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">59.720193</span>+<span class="number">08</span>:<span class="number">00</span> [<span class="keyword">debug</span>] <span class="variable">&lt;0.132.0&gt;</span> Boot <span class="keyword">state</span>/systemd: notifying of <span class="keyword">state</span> `ready`</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> ready 之后，状态就不显示了。</p>
<img src="/2026/01/18/rabbitmq-rabbitmq-startup-systemd/image15.png" class="" title="启动状态图">

<hr>
<h2 id="Shell-的一些用法补充"><a href="#Shell-的一些用法补充" class="headerlink" title="Shell 的一些用法补充"></a>Shell 的一些用法补充</h2><h3 id="set-e"><a href="#set-e" class="headerlink" title="set -e"></a>set -e</h3><p>在 shell 脚本中，<code>set -e</code> 是一个非常有用的指令，它的作用是让脚本在遇到任何一个命令返回非零退出状态（即命令执行失败）时，立即停止执行。</p>
<p>具体来说，在没有设置 <code>set -e</code> 时，即使脚本中的某个命令执行失败（退出状态码不为 0），脚本也会继续执行后续的命令。而当设置了 <code>set -e</code> 后，一旦某个命令返回非零退出状态，脚本会立即终止，不再执行后续的命令。</p>
<h3 id="检测-systemd-环境"><a href="#检测-systemd-环境" class="headerlink" title="检测 systemd 环境"></a>检测 systemd 环境</h3><p>如果环境变量 <code>NOTIFY_SOCKET</code> 被设置了，那么就将 <code>RUNNING_UNDER_SYSTEMD</code> 变量赋值为 <code>true</code>，表示当前脚本正在 systemd 环境下运行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="string">&quot;<span class="variable">$NOTIFY_SOCKET</span>&quot;</span> ] &amp;&amp; RUNNING_UNDER_SYSTEMD=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="systemd-notify-命令帮助"><a href="#systemd-notify-命令帮助" class="headerlink" title="systemd-notify 命令帮助"></a>systemd-notify 命令帮助</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">systemd-notify [OPTIONS...] [VARIABLE=VALUE...]</span><br><span class="line"></span><br><span class="line">Notify the init system about service status updates.</span><br><span class="line"></span><br><span class="line">  -h --<span class="built_in">help</span>       Show this <span class="built_in">help</span></span><br><span class="line">     --version    Show package version</span><br><span class="line">     --ready      Inform the init system about service start-up completion</span><br><span class="line">     --pid[=PID]  Set main PID of daemon</span><br><span class="line">     --uid=USER   Set user to send from</span><br><span class="line">     --status=TEXT Set status text</span><br><span class="line">     --booted     Check <span class="keyword">if</span> the system was booted up with systemd</span><br><span class="line">     --readahead=ACTION Controls read-ahead operations</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文详细介绍了 RabbitMQ 与 systemd 的集成方式，包括：</p>
<ol>
<li><strong>systemd 基本概念</strong>：术语解释和工作原理</li>
<li><strong>多语言实现</strong>：Shell、C、Python、Erlang 中使用 systemd-notify</li>
<li><strong>RabbitMQ 启动流程</strong>：从 systemd 启动到 READY 通知的完整过程</li>
<li><strong>配置与调试</strong>：service 文件配置、日志级别设置、常见问题排查</li>
</ol>
<p>通过 systemd 管理 RabbitMQ 服务，可以获得更好的进程监控、自动重启、日志管理等功能，是生产环境部署的推荐方式。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/RabbitMQ/" rel="tag"># RabbitMQ</a>
              <a href="/tags/Erlang/" rel="tag"># Erlang</a>
              <a href="/tags/Systemd/" rel="tag"># Systemd</a>
              <a href="/tags/Linux/" rel="tag"># Linux</a>
              <a href="/tags/%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86/" rel="tag"># 服务管理</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2026/01/17/rabbitmq-rabbitmq-deps-base64url-analysis/" rel="prev" title="RabbitMQ 依赖分析：base64url 模块深度解析">
                  <i class="fa fa-angle-left"></i> RabbitMQ 依赖分析：base64url 模块深度解析
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2026/01/18/rabbitmq-rabbitmq-deps-systemd-guide/" rel="next" title="RabbitMQ 依赖分析：Systemd 完整指南">
                  RabbitMQ 依赖分析：Systemd 完整指南 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2024 – 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Zixiang Sun</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"hzsunzixiang/hzsunzixiang.github.io","issue_term":"pathname","theme":"github-light"}</script>
<script src="/js/third-party/comments/utterances.js" defer></script>

</body>
</html>
