<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRAQäºŒè¿›åˆ¶æ ¼å¼åŒ–Traceæ—¥å¿—è¯¦ç»†è§£æ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .section {
            background: white;
            margin: 20px 0;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #667eea;
        }
        .trace-step {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .binary-breakdown {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .highlight {
            background-color: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
        .time-highlight {
            color: #e74c3c;
            font-weight: bold;
        }
        .process-highlight {
            color: #3498db;
            font-weight: bold;
        }
        .function-highlight {
            color: #27ae60;
            font-weight: bold;
        }
        .data-highlight {
            color: #8e44ad;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .byte-table {
            font-family: monospace;
            font-size: 12px;
        }
        .performance-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ” CRAQäºŒè¿›åˆ¶æ ¼å¼åŒ–Traceæ—¥å¿—è¯¦ç»†è§£æ</h1>
        <p>é€æ­¥è§£æentry_to_binaryå‡½æ•°çš„å®Œæ•´æ‰§è¡Œè¿‡ç¨‹</p>
    </div>

    <div class="section">
        <h2>ğŸ“‹ Traceæ—¥å¿—æ—¶é—´çº¿åˆ†æ</h2>
        
        <div class="trace-step">
            <h3>æ­¥éª¤1: å‡½æ•°è°ƒç”¨å…¥å£</h3>
            <div class="code-block">
<span class="time-highlight">4:3:29.165796</span> <span class="process-highlight">&lt;0.907.0&gt;</span> <span class="function-highlight">eh_storage_data_api:entry_to_binary</span>(<span class="data-highlight">{eh_storage_data,person,10,1,1,1,name,john}</span>)
            </div>
            <p><strong>è§£æ</strong>:</p>
            <ul>
                <li><strong>æ—¶é—´æˆ³</strong>: 4:3:29.165796 (4å°æ—¶3åˆ†29ç§’165796å¾®ç§’)</li>
                <li><strong>è¿›ç¨‹ID</strong>: &lt;0.907.0&gt; (Node1çš„æ•°æ®æœåŠ¡å™¨è¿›ç¨‹)</li>
                <li><strong>å‡½æ•°</strong>: entry_to_binary/1 - äºŒè¿›åˆ¶æ ¼å¼åŒ–å…¥å£å‡½æ•°</li>
                <li><strong>è¾“å…¥æ•°æ®</strong>: personå¯¹è±¡ï¼ŒID=10ï¼Œtimestamp=1ï¼Œå­—æ®µname=john</li>
            </ul>
        </div>

        <div class="trace-step">
            <h3>æ­¥éª¤2: Erlangåºåˆ—åŒ–å’Œå“ˆå¸Œè®¡ç®—</h3>
            <div class="code-block">
<span class="time-highlight">4:3:29.165850</span> <span class="process-highlight">&lt;0.907.0&gt;</span> <span class="function-highlight">eh_storage_data_api:compute_hash</span>(<span class="data-highlight">48</span>, &lt;&lt;<span class="highlight">131,104,8,119,15,101,104,95,115,116,111,114,97,103,101,95,100,97,116,97,119,
  6,112,101,114,115,111,110,97,10,97,1,97,1,97,1,119,4,110,97,109,101,119,4,
  106,111,104,110</span>&gt;&gt;)
            </div>
            <p><strong>è§£æ</strong>:</p>
            <ul>
                <li><strong>å»¶è¿Ÿ</strong>: 54å¾®ç§’ (165850-165796) - term_to_binaryæ‰§è¡Œæ—¶é—´</li>
                <li><strong>æ•°æ®é•¿åº¦</strong>: 48å­—èŠ‚</li>
                <li><strong>åºåˆ—åŒ–æ•°æ®</strong>: ErlangäºŒè¿›åˆ¶æ ¼å¼ï¼ŒåŒ…å«å®Œæ•´çš„recordç»“æ„</li>
            </ul>
        </div>

        <div class="trace-step">
            <h3>æ­¥éª¤3: SHA1å“ˆå¸Œè®¡ç®—å®Œæˆ</h3>
            <div class="code-block">
<span class="time-highlight">4:3:29.173638</span> <span class="process-highlight">&lt;0.907.0&gt;</span> <span class="function-highlight">eh_storage_data_api:compute_hash/2</span> --> &lt;&lt;<span class="highlight">14,44,20,124,15,47,29,224,165,109,43,214,98,161,236,120,147,143,149,172</span>&gt;&gt;
            </div>
            <p><strong>è§£æ</strong>:</p>
            <ul>
                <li><strong>å“ˆå¸Œè®¡ç®—æ—¶é—´</strong>: 7788å¾®ç§’ (173638-165850) â‰ˆ 7.8ms</li>
                <li><strong>SHA1ç»“æœ</strong>: 20å­—èŠ‚å“ˆå¸Œå€¼</li>
                <li><strong>å“ˆå¸Œè¾“å…¥</strong>: [4å­—èŠ‚é•¿åº¦] + [48å­—èŠ‚æ•°æ®]</li>
            </ul>
        </div>

        <div class="trace-step">
            <h3>æ­¥éª¤4: å‡½æ•°è¿”å›å‡†å¤‡</h3>
            <div class="code-block">
<span class="time-highlight">4:3:29.173825</span> <span class="process-highlight">&lt;0.907.0&gt;</span>  '--> <span class="function-highlight">eh_storage_data_api:entry_to_binary/1</span>
            </div>
            <p><strong>è§£æ</strong>:</p>
            <ul>
                <li><strong>å‡½æ•°é€€å‡ºå‡†å¤‡</strong>: 187å¾®ç§’å»¶è¿Ÿ (173825-173638)</li>
                <li><strong>äºŒè¿›åˆ¶æ‹¼æ¥</strong>: ç»„è£…æœ€ç»ˆçš„äºŒè¿›åˆ¶æ ¼å¼</li>
            </ul>
        </div>

        <div class="trace-step">
            <h3>æ­¥éª¤5: æœ€ç»ˆäºŒè¿›åˆ¶ç»“æœè¿”å›</h3>
            <div class="code-block">
<span class="time-highlight">4:3:29.173845</span> <span class="process-highlight">&lt;0.907.0&gt;</span> <span class="function-highlight">eh_storage_data_api:entry_to_binary/1</span> --> &lt;&lt;<span class="highlight">14,44,20,124,15,47,29,224,165,109,43,214,98,161,236,120,147,143,149,172,0,0,
  0,48,131,104,8,119,15,101,104,95,115,116,111,114,97,103,101,95,100,97,116,97,
  119,6,112,101,114,115,111,110,97,10,97,1,97,1,97,1,119,4,110,97,109,101,119,
  4,106,111,104,110</span>&gt;&gt;
            </div>
            <p><strong>è§£æ</strong>:</p>
            <ul>
                <li><strong>æ€»æ‰§è¡Œæ—¶é—´</strong>: 8049å¾®ç§’ (173845-165796) â‰ˆ 8.05ms</li>
                <li><strong>æœ€ç»ˆç»“æœ</strong>: 72å­—èŠ‚å®Œæ•´äºŒè¿›åˆ¶æ ¼å¼</li>
                <li><strong>æ ¼å¼ç»“æ„</strong>: [20å­—èŠ‚å“ˆå¸Œ] + [4å­—èŠ‚é•¿åº¦] + [48å­—èŠ‚æ•°æ®]</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ”¢ äºŒè¿›åˆ¶æ•°æ®è¯¦ç»†åˆ†è§£</h2>

        <div class="binary-breakdown">
            <h3>ğŸ“¦ æœ€ç»ˆäºŒè¿›åˆ¶æ ¼å¼ (72å­—èŠ‚)</h3>
            <table class="byte-table">
                <tr>
                    <th>å­—èŠ‚èŒƒå›´</th>
                    <th>å†…å®¹</th>
                    <th>åå…­è¿›åˆ¶</th>
                    <th>è¯´æ˜</th>
                </tr>
                <tr>
                    <td>0-19 (20å­—èŠ‚)</td>
                    <td>SHA1å“ˆå¸Œ</td>
                    <td>0E 2C 14 7C 0F 2F 1D E0 A5 6D 2B D6 62 A1 EC 78 93 8F 95 AC</td>
                    <td>æ•°æ®å®Œæ•´æ€§æ ¡éªŒ</td>
                </tr>
                <tr>
                    <td>20-23 (4å­—èŠ‚)</td>
                    <td>æ•°æ®é•¿åº¦</td>
                    <td>00 00 00 30 (48)</td>
                    <td>åºåˆ—åŒ–æ•°æ®é•¿åº¦</td>
                </tr>
                <tr>
                    <td>24-71 (48å­—èŠ‚)</td>
                    <td>åºåˆ—åŒ–æ•°æ®</td>
                    <td>83 68 08 77 0F 65 68 5F 73 74 6F 72 61 67 65 5F 64 61 74 61...</td>
                    <td>Erlang term_to_binaryç»“æœ</td>
                </tr>
            </table>
        </div>

        <div class="binary-breakdown">
            <h3>ğŸ” Erlangåºåˆ—åŒ–æ•°æ®è§£æ (48å­—èŠ‚)</h3>
            <div class="code-block">
åŸå§‹æ•°æ®: {eh_storage_data,person,10,1,1,1,name,john}

åºåˆ—åŒ–åˆ†è§£:
131        - Erlangå¤–éƒ¨æ ¼å¼ç‰ˆæœ¬æ ‡è¯†
104,8      - 8å…ƒç´ tupleæ ‡è¯†
119,15     - 15å­—ç¬¦atom: "eh_storage_data"
119,6      - 6å­—ç¬¦atom: "person"  
97,10      - å°æ•´æ•°: 10
97,1       - å°æ•´æ•°: 1 (timestamp)
97,1       - å°æ•´æ•°: 1 (field_id)
97,1       - å°æ•´æ•°: 1 (active)
119,4      - 4å­—ç¬¦atom: "name"
119,4      - 4å­—ç¬¦atom: "john"
            </div>
        </div>
    </div>

    <div class="section">
        <h2>â±ï¸ æ€§èƒ½åˆ†æ</h2>

        <div class="performance-box">
            <h3>ğŸš€ æ‰§è¡Œæ—¶é—´åˆ†è§£</h3>
            <table>
                <tr>
                    <th>æ“ä½œé˜¶æ®µ</th>
                    <th>å¼€å§‹æ—¶é—´</th>
                    <th>ç»“æŸæ—¶é—´</th>
                    <th>è€—æ—¶(Î¼s)</th>
                    <th>å æ¯”</th>
                </tr>
                <tr>
                    <td>term_to_binaryåºåˆ—åŒ–</td>
                    <td>165796</td>
                    <td>165850</td>
                    <td>54</td>
                    <td>0.7%</td>
                </tr>
                <tr>
                    <td>SHA1å“ˆå¸Œè®¡ç®—</td>
                    <td>165850</td>
                    <td>173638</td>
                    <td>7788</td>
                    <td>96.8%</td>
                </tr>
                <tr>
                    <td>äºŒè¿›åˆ¶æ‹¼æ¥å’Œè¿”å›</td>
                    <td>173638</td>
                    <td>173845</td>
                    <td>207</td>
                    <td>2.5%</td>
                </tr>
                <tr>
                    <td><strong>æ€»è®¡</strong></td>
                    <td>165796</td>
                    <td>173845</td>
                    <td><strong>8049</strong></td>
                    <td><strong>100%</strong></td>
                </tr>
            </table>
        </div>

        <div class="performance-box">
            <h3>ğŸ“Š æ€§èƒ½ç“¶é¢ˆåˆ†æ</h3>
            <ul>
                <li><strong>SHA1å“ˆå¸Œè®¡ç®—</strong>: å ç”¨96.8%çš„æ‰§è¡Œæ—¶é—´ (7.8ms)</li>
                <li><strong>åºåˆ—åŒ–æ“ä½œ</strong>: éå¸¸é«˜æ•ˆï¼Œä»…54å¾®ç§’</li>
                <li><strong>äºŒè¿›åˆ¶æ“ä½œ</strong>: æ‹¼æ¥å’Œè¿”å›207å¾®ç§’</li>
                <li><strong>ä¼˜åŒ–å»ºè®®</strong>: å¯è€ƒè™‘ä½¿ç”¨æ›´å¿«çš„å“ˆå¸Œç®—æ³•(å¦‚CRC32)ç”¨äºéå®‰å…¨åœºæ™¯</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ”§ æºä»£ç å¯¹åº”å…³ç³»</h2>

        <div class="code-block">
%% eh_storage_data_api.erl:37-46
entry_to_binary(Entry) ->
  Bin = term_to_binary(Entry),           %% æ­¥éª¤1: 54Î¼s
  BinSize = byte_size(Bin),              %% è®¡ç®—å¾—åˆ°48
  
  Sha = compute_hash(BinSize, Bin),      %% æ­¥éª¤2: 7788Î¼s
  
  &lt;&lt;Sha:?SHA_BYTE_SIZE/binary,           %% æ­¥éª¤3: 207Î¼s
    BinSize:?DATA_BIT_SIZE,              %% 4å­—èŠ‚é•¿åº¦
    Bin:BinSize/binary&gt;&gt;.               %% 48å­—èŠ‚æ•°æ®

%% eh_storage_data_api.erl:65-68  
compute_hash(BinSize, Bin) ->
  B1 = &lt;&lt;BinSize:?DATA_BIT_SIZE, Bin:BinSize/binary&gt;&gt;,  %% ç»„è£…å“ˆå¸Œè¾“å…¥
  crypto:hash(sha, B1).                                %% SHA1è®¡ç®—
        </div>
    </div>

    <div class="section">
        <h2>ğŸ¯ å…³é”®å‘ç°æ€»ç»“</h2>

        <div class="binary-breakdown">
            <h3>ğŸ’¡ é‡è¦è§‚å¯Ÿ</h3>
            <ol>
                <li><strong>å“ˆå¸Œè®¡ç®—æ˜¯æ€§èƒ½ç“¶é¢ˆ</strong>: SHA1è®¡ç®—å ç”¨äº†96.8%çš„æ‰§è¡Œæ—¶é—´</li>
                <li><strong>Erlangåºåˆ—åŒ–é«˜æ•ˆ</strong>: term_to_binaryä»…éœ€54å¾®ç§’å¤„ç†48å­—èŠ‚æ•°æ®</li>
                <li><strong>æ•°æ®å®Œæ•´æ€§ä¼˜å…ˆ</strong>: ç³»ç»Ÿé€‰æ‹©å®‰å…¨çš„SHA1è€Œéæ€§èƒ½ä¼˜å…ˆçš„ç®—æ³•</li>
                <li><strong>æ ¼å¼è‡ªæè¿°</strong>: åŒ…å«é•¿åº¦ä¿¡æ¯ï¼Œæ”¯æŒæµå¼å¤„ç†å’ŒéªŒè¯</li>
                <li><strong>åŸå­æ“ä½œè®¾è®¡</strong>: æ•´ä¸ªè¿‡ç¨‹8mså†…å®Œæˆï¼Œä¿è¯åŸå­æ€§</li>
            </ol>
        </div>

        <div class="performance-box">
            <h3>ğŸ—ï¸ æ¶æ„æ„ä¹‰</h3>
            <p>è¿™ä¸ªtraceæ—¥å¿—å±•ç¤ºäº†CRAQç³»ç»Ÿåœ¨æ•°æ®å®Œæ•´æ€§å’Œæ€§èƒ½ä¹‹é—´çš„æƒè¡¡é€‰æ‹©ã€‚è™½ç„¶SHA1å“ˆå¸Œè®¡ç®—ç›¸å¯¹è€—æ—¶ï¼Œä½†å®ƒæä¾›äº†å¼ºå¤§çš„æ•°æ®å®Œæ•´æ€§ä¿è¯ï¼Œè¿™å¯¹äºåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿçš„å¯é æ€§è‡³å…³é‡è¦ã€‚8msçš„æ€»å»¶è¿Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ˜¯å¯æ¥å—çš„ï¼Œç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°å®ƒåŒ…å«äº†å®Œæ•´çš„åºåˆ—åŒ–ã€å“ˆå¸Œè®¡ç®—å’Œæ ¼å¼åŒ–è¿‡ç¨‹ã€‚</p>
        </div>
    </div>
</body>
</html>