<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†å¸ƒå¼ç³»ç»Ÿå¿«ç…§ (Snapshot) æ¦‚å¿µå…¨è§£</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --info: #0ea5e9;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --code-bg: #1e293b;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.8;
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Hero Header */
        .hero {
            background: var(--gradient-1);
            color: white;
            padding: 4rem 3rem;
            border-radius: 24px;
            margin-bottom: 2rem;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .hero .subtitle {
            font-size: 1.25rem;
            opacity: 0.9;
            position: relative;
        }

        .hero .badges {
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            position: relative;
        }

        .hero .badge {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        /* Navigation */
        .nav-toc {
            background: var(--card);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: sticky;
            top: 1rem;
            z-index: 100;
        }

        .nav-toc h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .nav-toc ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .nav-toc a {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--bg);
            color: var(--text);
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.875rem;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .nav-toc a:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        /* Sections */
        .section {
            background: var(--card);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            border: 1px solid var(--border);
        }

        .section h2 {
            color: var(--primary-dark);
            font-size: 1.875rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid var(--primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section h3 {
            color: var(--text);
            font-size: 1.375rem;
            margin: 2rem 0 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section h4 {
            color: var(--secondary);
            font-size: 1.125rem;
            margin: 1.5rem 0 0.75rem;
        }

        /* Definition Box */
        .definition-box {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left: 5px solid var(--primary);
            padding: 2rem;
            border-radius: 0 16px 16px 0;
            margin: 1.5rem 0;
        }

        .definition-box h4 {
            color: var(--primary-dark);
            margin-top: 0;
            font-size: 1.25rem;
        }

        .definition-box .term {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        .definition-box .phonetic {
            color: var(--text-muted);
            font-style: italic;
            margin-bottom: 1rem;
        }

        /* Protocol Cards */
        .protocol-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .protocol-card {
            background: var(--card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 2px solid var(--border);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .protocol-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .protocol-card.raft::before { background: var(--gradient-2); }
        .protocol-card.craq::before { background: var(--gradient-3); }
        .protocol-card.zab::before { background: var(--gradient-1); }

        .protocol-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.12);
        }

        .protocol-card h4 {
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .protocol-card .logo {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Code Blocks */
        pre {
            background: var(--code-bg);
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 12px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'JetBrains Mono', 'Fira Code', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            position: relative;
        }

        pre::before {
            content: attr(data-lang);
            position: absolute;
            top: 0.5rem;
            right: 1rem;
            color: #64748b;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        code {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
        }

        :not(pre) > code {
            background: #e0e7ff;
            color: var(--primary-dark);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9em;
        }

        /* Syntax Highlighting */
        .keyword { color: #c678dd; }
        .function { color: #61afef; }
        .string { color: #98c379; }
        .comment { color: #5c6370; font-style: italic; }
        .number { color: #d19a66; }
        .atom { color: #e5c07b; }
        .variable { color: #e06c75; }
        .operator { color: #56b6c2; }
        .type { color: #e5c07b; }

        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.95rem;
        }

        .comparison-table th {
            background: var(--primary);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }

        .comparison-table th:first-child {
            border-radius: 12px 0 0 0;
        }

        .comparison-table th:last-child {
            border-radius: 0 12px 0 0;
        }

        .comparison-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            vertical-align: top;
        }

        .comparison-table tr:hover {
            background: var(--bg);
        }

        .comparison-table tr:last-child td:first-child {
            border-radius: 0 0 0 12px;
        }

        .comparison-table tr:last-child td:last-child {
            border-radius: 0 0 12px 0;
        }

        /* Info Boxes */
        .info-box {
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border-left: 4px solid;
        }

        .info-box.concept {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: var(--success);
        }

        .info-box.warning {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-color: var(--accent);
        }

        .info-box.theory {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-color: var(--info);
        }

        .info-box.danger {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: var(--danger);
        }

        .info-box h4 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Flow Diagram */
        .flow-diagram {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 2rem;
            border-radius: 16px;
            margin: 1.5rem 0;
            border: 1px solid var(--border);
            overflow-x: auto;
        }

        .flow-diagram pre {
            background: transparent;
            color: var(--text);
            padding: 0;
            margin: 0;
            font-size: 0.85rem;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 2rem;
            margin: 1.5rem 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--gradient-1);
            border-radius: 3px;
        }

        .timeline-item {
            position: relative;
            padding: 1rem 0 1rem 1.5rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2rem;
            top: 1.25rem;
            width: 12px;
            height: 12px;
            background: var(--primary);
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 3px var(--primary);
        }

        .timeline-item h4 {
            margin: 0 0 0.5rem;
            color: var(--primary-dark);
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .feature-card {
            background: var(--bg);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .feature-card .icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .feature-card h4 {
            margin: 0 0 0.5rem;
            color: var(--primary-dark);
        }

        /* Quote */
        .quote {
            background: var(--bg);
            border-left: 4px solid var(--secondary);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 12px 12px 0;
            font-style: italic;
        }

        .quote .source {
            margin-top: 1rem;
            font-style: normal;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Mathematical Formula */
        .formula {
            background: var(--bg);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 1.2rem;
            margin: 1rem 0;
            border: 1px solid var(--border);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .hero {
                padding: 2rem 1.5rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .section {
                padding: 1.5rem;
            }

            .protocol-grid {
                grid-template-columns: 1fr;
            }

            .nav-toc ul {
                flex-direction: column;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section {
            animation: fadeInUp 0.6s ease-out;
        }

        /* Highlight */
        .highlight {
            background: linear-gradient(120deg, #fef08a 0%, #fef08a 100%);
            background-size: 100% 40%;
            background-repeat: no-repeat;
            background-position: 0 90%;
            padding: 0 0.2rem;
        }

        /* Tags */
        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .tag.raft { background: #fce7f3; color: #be185d; }
        .tag.craq { background: #cffafe; color: #0891b2; }
        .tag.zab { background: #e0e7ff; color: #4338ca; }
        .tag.paxos { background: #fef3c7; color: #b45309; }

        /* Erlang specific */
        .erlang-struct {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 1px solid #f59e0b;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .erlang-struct h4 {
            color: #b45309;
            margin-top: 0;
        }
    </style>
</head>
<body>
<!-- CRAQ æ–‡æ¡£å¯¼èˆªæ  -->
<div id="craq-nav" style="
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(15, 15, 35, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding: 12px 20px;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
">
    <a href="/craq/" style="
        color: #00d4ff;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
    " onmouseover="this.style.color='#7c3aed'" onmouseout="this.style.color='#00d4ff'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
        è¿”å› CRAQ æ–‡æ¡£é¦–é¡µ
    </a>
    
    <div style="flex: 1;"></div>
    
    <a href="/" style="
        color: #888;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.3s ease;
    " onmouseover="this.style.color='#fff'" onmouseout="this.style.color='#888'">
        åšå®¢é¦–é¡µ
    </a>
</div>

<!-- ä¸ºå¯¼èˆªæ æ·»åŠ é¡¶éƒ¨é—´è· -->
<div style="height: 60px;"></div>

    <div class="container">
        <!-- Hero Header -->
        <header class="hero">
            <h1>ğŸ“¸ åˆ†å¸ƒå¼ç³»ç»Ÿå¿«ç…§ (Snapshot) æ¦‚å¿µå…¨è§£</h1>
            <p class="subtitle">ä»ç†è®ºå®šä¹‰åˆ°å·¥ç¨‹å®è·µï¼šRaftã€CRAQã€ZAB åè®®ä¸­çš„å¿«ç…§æœºåˆ¶æ·±åº¦è§£æ</p>
            <div class="badges">
                <span class="badge">ğŸ”¬ ç†è®ºåŸºç¡€</span>
                <span class="badge">ğŸ“„ è®ºæ–‡è§£è¯»</span>
                <span class="badge">ğŸ’» Erlang å®ç°</span>
                <span class="badge">ğŸ”„ åˆ†å¸ƒå¼ä¸€è‡´æ€§</span>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-toc">
            <h3>ğŸ“‘ ç›®å½•å¯¼èˆª</h3>
            <ul>
                <li><a href="#definition">ä¸€ã€å¿«ç…§å®šä¹‰</a></li>
                <li><a href="#theory">äºŒã€ç†è®ºåŸºç¡€</a></li>
                <li><a href="#protocols">ä¸‰ã€åè®®å¯¹æ¯”</a></li>
                <li><a href="#raft">å››ã€Raft å¿«ç…§</a></li>
                <li><a href="#craq">äº”ã€CRAQ å¿«ç…§</a></li>
                <li><a href="#erlang">å…­ã€Erlang å®ç°</a></li>
                <li><a href="#scenarios">ä¸ƒã€åº”ç”¨åœºæ™¯</a></li>
                <li><a href="#comparison">å…«ã€æœºåˆ¶å¯¹æ¯”</a></li>
                <li><a href="#summary">ä¹ã€æ€»ç»“</a></li>
            </ul>
        </nav>

        <!-- Section 1: Definition -->
        <section id="definition" class="section">
            <h2>ğŸ“– ä¸€ã€å¿«ç…§çš„å®šä¹‰</h2>

            <div class="definition-box">
                <div class="term">Snapshotï¼ˆå¿«ç…§ï¼‰</div>
                <div class="phonetic">/ËˆsnÃ¦pÊƒÉ’t/ | åè¯</div>
                <p><strong>å¿«ç…§</strong>æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æŸä¸€æ—¶åˆ»<strong>å…¨å±€çŠ¶æ€çš„ä¸€è‡´æ€§å‰¯æœ¬</strong>ï¼Œå®ƒæ•è·äº†ç³»ç»Ÿåœ¨ç‰¹å®šé€»è¾‘æ—¶é—´ç‚¹çš„å®Œæ•´æ•°æ®è§†å›¾ï¼Œç”¨äº<strong>çŠ¶æ€æ¢å¤</strong>ã€<strong>æ•°æ®åŒæ­¥</strong>å’Œ<strong>æ—¥å¿—å‹ç¼©</strong>ã€‚</p>
            </div>

            <h3>1.1 å¿«ç…§çš„æœ¬è´¨</h3>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="icon">â±ï¸</div>
                    <h4>æ—¶é—´åˆ‡ç‰‡</h4>
                    <p>å¿«ç…§æ˜¯ç³»ç»ŸçŠ¶æ€åœ¨æŸä¸ª<strong>é€»è¾‘æ—¶é—´ç‚¹</strong>çš„"å†»ç»“"ï¼Œå°±åƒç»™è¿åŠ¨ä¸­çš„ç³»ç»Ÿæ‹äº†ä¸€å¼ ç…§ç‰‡ã€‚</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ”’</div>
                    <h4>ä¸€è‡´æ€§è¾¹ç•Œ</h4>
                    <p>å¿«ç…§å®šä¹‰äº†ä¸€ä¸ª<strong>ä¸€è‡´æ€§è¾¹ç•Œ</strong>ï¼Œè¾¹ç•Œä¹‹å‰çš„æ‰€æœ‰æ“ä½œéƒ½å·²å®Œæˆï¼Œè¾¹ç•Œä¹‹åçš„æ“ä½œå°šæœªå¼€å§‹ã€‚</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ“¦</div>
                    <h4>çŠ¶æ€å‹ç¼©</h4>
                    <p>å¿«ç…§å°†å¤§é‡å†å²æ“ä½œ<strong>å‹ç¼©</strong>ä¸ºä¸€ä¸ªç´§å‡‘çš„çŠ¶æ€è¡¨ç¤ºï¼Œå‡å°‘å­˜å‚¨å’Œä¼ è¾“å¼€é”€ã€‚</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ”„</div>
                    <h4>æ¢å¤åŸºç‚¹</h4>
                    <p>å¿«ç…§ä½œä¸ºç³»ç»Ÿæ¢å¤çš„<strong>èµ·ç‚¹</strong>ï¼Œåªéœ€é‡æ”¾å¿«ç…§ä¹‹åçš„æ—¥å¿—å³å¯æ¢å¤å®Œæ•´çŠ¶æ€ã€‚</p>
                </div>
            </div>

            <h3>1.2 å¿«ç…§çš„å½¢å¼åŒ–å®šä¹‰</h3>

            <div class="info-box theory">
                <h4>ğŸ“ æ•°å­¦å®šä¹‰</h4>
                <p>è®¾åˆ†å¸ƒå¼ç³»ç»Ÿ S ç”± n ä¸ªè¿›ç¨‹ P = {pâ‚, pâ‚‚, ..., pâ‚™} ç»„æˆï¼Œæ¯ä¸ªè¿›ç¨‹ páµ¢ æœ‰æœ¬åœ°çŠ¶æ€ sáµ¢ã€‚</p>
                <div class="formula">
                    <strong>å…¨å±€å¿«ç…§ G = (S, C)</strong><br>
                    å…¶ä¸­ S = {sâ‚, sâ‚‚, ..., sâ‚™} æ˜¯æ‰€æœ‰è¿›ç¨‹çš„æœ¬åœ°çŠ¶æ€é›†åˆ<br>
                    C = {cáµ¢â±¼} æ˜¯æ‰€æœ‰é€šä¿¡é€šé“çš„çŠ¶æ€ï¼ˆåœ¨é€”æ¶ˆæ¯ï¼‰
                </div>
                <p>ä¸€ä¸ª<strong>ä¸€è‡´æ€§å¿«ç…§</strong>å¿…é¡»æ»¡è¶³ï¼šå¦‚æœå¿«ç…§åŒ…å«äº†æ¶ˆæ¯ m çš„æ¥æ”¶äº‹ä»¶ï¼Œåˆ™å¿…é¡»åŒ…å« m çš„å‘é€äº‹ä»¶ã€‚</p>
            </div>

            <h3>1.3 å¿«ç…§çš„ä¸‰è¦ç´ </h3>

            <pre data-lang="æ¦‚å¿µæ¨¡å‹">
<span class="comment">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="comment">â”‚                      å¿«ç…§ (Snapshot)                         â”‚</span>
<span class="comment">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="comment">â”‚                                                              â”‚</span>
<span class="comment">â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚</span>
<span class="comment">â”‚   â”‚   æ—¶é—´æ ‡è¯†    â”‚   â”‚   çŠ¶æ€æ•°æ®    â”‚   â”‚   å…ƒæ•°æ®     â”‚   â”‚</span>
<span class="comment">â”‚   â”‚  (Timestamp)  â”‚   â”‚   (State)    â”‚   â”‚  (Metadata)  â”‚   â”‚</span>
<span class="comment">â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚</span>
<span class="comment">â”‚         â†“                  â†“                  â†“             â”‚</span>
<span class="comment">â”‚    é€»è¾‘æ—¶é’Ÿ/ä»»æœŸ      é”®å€¼å¯¹/æ—¥å¿—ç´¢å¼•      é…ç½®/æˆå‘˜ä¿¡æ¯      â”‚</span>
<span class="comment">â”‚                                                              â”‚</span>
<span class="comment">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
            </pre>
        </section>

        <!-- Section 2: Theory -->
        <section id="theory" class="section">
            <h2>ğŸ”¬ äºŒã€ç†è®ºåŸºç¡€</h2>

            <h3>2.1 Chandy-Lamport å¿«ç…§ç®—æ³•</h3>

            <div class="quote">
                <p>"åˆ†å¸ƒå¼å¿«ç…§çš„æ ¸å¿ƒæŒ‘æˆ˜æ˜¯ï¼šåœ¨æ²¡æœ‰å…¨å±€æ—¶é’Ÿçš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•æ•è·ä¸€ä¸ªä¸€è‡´çš„å…¨å±€çŠ¶æ€ï¼Ÿ"</p>
                <div class="source">â€” K. Mani Chandy & Leslie Lamport, 1985</div>
            </div>

            <div class="info-box concept">
                <h4>ğŸ’¡ æ ¸å¿ƒæ€æƒ³</h4>
                <p>Chandy-Lamport ç®—æ³•é€šè¿‡<strong>æ ‡è®°æ¶ˆæ¯ (Marker)</strong> åœ¨ç³»ç»Ÿä¸­ä¼ æ’­ï¼Œè§¦å‘å„èŠ‚ç‚¹è®°å½•æœ¬åœ°çŠ¶æ€ã€‚å½“ä¸€ä¸ªè¿›ç¨‹æ”¶åˆ°æ ‡è®°åï¼š</p>
                <ol>
                    <li>å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ”¶åˆ°æ ‡è®°ï¼Œè®°å½•æœ¬åœ°çŠ¶æ€ï¼Œç„¶åå‘æ‰€æœ‰å‡ºè¾¹å‘é€æ ‡è®°</li>
                    <li>è®°å½•ä»æ”¶åˆ°ç¬¬ä¸€ä¸ªæ ‡è®°åˆ°æ”¶åˆ°è¯¥é€šé“æ ‡è®°ä¹‹é—´çš„æ‰€æœ‰æ¶ˆæ¯ï¼ˆé€šé“çŠ¶æ€ï¼‰</li>
                </ol>
            </div>

            <div class="flow-diagram">
                <pre>
æ—¶é—´ â†’
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  Chandy-Lamport ç®—æ³•æµç¨‹                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

P1:  â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€[M]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
           â†˜                    è®°å½•çŠ¶æ€ S1
                â†˜
P2:  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€[M]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
                    â†˜          è®°å½•çŠ¶æ€ S2
                        â†˜
P3:  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€[M]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
                              â†˜    è®°å½•çŠ¶æ€ S3
                                  â†˜
P4:  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
                                        è®°å½•çŠ¶æ€ S4

        â—  = æ”¶åˆ° Markerï¼ˆæ ‡è®°ï¼‰
        [M] = å‘é€ Marker
        æœ€ç»ˆå¿«ç…§ = {S1, S2, S3, S4} + é€šé“çŠ¶æ€
                </pre>
            </div>

            <h3>2.2 ä¸€è‡´æ€§åˆ‡å‰² (Consistent Cut)</h3>

            <div class="info-box theory">
                <h4>ğŸ“ å®šä¹‰</h4>
                <p><strong>åˆ‡å‰² (Cut)</strong>ï¼šç³»ç»Ÿæ‰§è¡Œå†å²çš„ä¸€ä¸ªå‰ç¼€é›†åˆï¼ŒåŒ…å«æ¯ä¸ªè¿›ç¨‹çš„ä¸€ä¸ªäº‹ä»¶å‰ç¼€ã€‚</p>
                <p><strong>ä¸€è‡´æ€§åˆ‡å‰²</strong>ï¼šå¦‚æœåˆ‡å‰²åŒ…å«äº‹ä»¶ eï¼Œåˆ™å¿…é¡»åŒ…å«æ‰€æœ‰ happens-before e çš„äº‹ä»¶ã€‚</p>
                <div class="formula">
                    Cut C æ˜¯ä¸€è‡´çš„ âŸº âˆ€e âˆˆ C, âˆ€e' : e' â†’ e âŸ¹ e' âˆˆ C
                </div>
            </div>

            <pre data-lang="ç¤ºæ„å›¾">
<span class="comment">ä¸€è‡´æ€§åˆ‡å‰² vs éä¸€è‡´æ€§åˆ‡å‰²</span>

è¿›ç¨‹ P1: â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â†’
              e1       e3

è¿›ç¨‹ P2: â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â†’
                  e2   â†—   e4
                      æ¶ˆæ¯

<span class="keyword">âœ… ä¸€è‡´æ€§åˆ‡å‰²:</span> {e1, e2} - åŒ…å«æ¶ˆæ¯å‘é€å’Œæ¥æ”¶
<span class="danger">âŒ éä¸€è‡´æ€§åˆ‡å‰²:</span> {e3, e2} - åŒ…å«æ¥æ”¶ä½†ä¸åŒ…å«å‘é€ï¼ˆå› æœè¿åï¼‰
            </pre>

            <h3>2.3 å¿«ç…§ä¸å› æœä¸€è‡´æ€§</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <h4>é€»è¾‘æ—¶é’Ÿ (Lamport Clock)</h4>
                    <p>ä¸ºæ¯ä¸ªäº‹ä»¶åˆ†é…ä¸€ä¸ªé€»è¾‘æ—¶é—´æˆ³ï¼Œä¿è¯ e â†’ e' âŸ¹ LC(e) < LC(e')</p>
                </div>
                <div class="timeline-item">
                    <h4>å‘é‡æ—¶é’Ÿ (Vector Clock)</h4>
                    <p>æ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªå‘é‡ï¼Œç²¾ç¡®æ•è·å› æœå…³ç³»ï¼šVC(e) < VC(e') âŸº e â†’ e'</p>
                </div>
                <div class="timeline-item">
                    <h4>å¿«ç…§æ—¶é—´æˆ³</h4>
                    <p>å¿«ç…§çš„æ—¶é—´æˆ³æ ‡è¯†äº†ä¸€ä¸ªä¸€è‡´æ€§è¾¹ç•Œï¼Œæ‰€æœ‰ â‰¤ è¯¥æ—¶é—´æˆ³çš„æ“ä½œéƒ½åŒ…å«åœ¨å¿«ç…§ä¸­</p>
                </div>
            </div>
        </section>

        <!-- Section 3: Protocols -->
        <section id="protocols" class="section">
            <h2>ğŸ”„ ä¸‰ã€ä¸»æµåè®®ä¸­çš„å¿«ç…§</h2>

            <div class="protocol-grid">
                <div class="protocol-card raft">
                    <div class="logo">ğŸ—³ï¸</div>
                    <h4><span class="tag raft">Raft</span> æ—¥å¿—å‹ç¼©å¿«ç…§</h4>
                    <p><strong>ç›®çš„ï¼š</strong>å‹ç¼©æ—¥å¿—ï¼Œé˜²æ­¢æ— é™å¢é•¿</p>
                    <p><strong>å†…å®¹ï¼š</strong>çŠ¶æ€æœºçŠ¶æ€ + lastIncludedIndex + lastIncludedTerm</p>
                    <p><strong>è§¦å‘ï¼š</strong>æ—¥å¿—è¾¾åˆ°é˜ˆå€¼æˆ– Leader å‘é€ç»™è½åçš„ Follower</p>
                    <p><strong>ç‰¹ç‚¹ï¼š</strong>æ¯ä¸ªèŠ‚ç‚¹ç‹¬ç«‹åˆ›å»ºï¼Œé€šè¿‡ InstallSnapshot RPC ä¼ è¾“</p>
                </div>

                <div class="protocol-card craq">
                    <div class="logo">â›“ï¸</div>
                    <h4><span class="tag craq">CRAQ</span> å¢é‡åŒæ­¥å¿«ç…§</h4>
                    <p><strong>ç›®çš„ï¼š</strong>æ–°èŠ‚ç‚¹åŠ å…¥æ—¶çš„æ•°æ®åŒæ­¥</p>
                    <p><strong>å†…å®¹ï¼š</strong>Timestamp + DataIndexListï¼ˆå¯¹è±¡çº§ç´¢å¼•ï¼‰</p>
                    <p><strong>è§¦å‘ï¼š</strong>æ–°èŠ‚ç‚¹åŠ å…¥é“¾æˆ–èŠ‚ç‚¹æ•…éšœæ¢å¤</p>
                    <p><strong>ç‰¹ç‚¹ï¼š</strong>è½»é‡çº§å…ƒæ•°æ®å¿«ç…§ï¼Œé…åˆå¢é‡æ•°æ®ä¼ è¾“</p>
                </div>

                <div class="protocol-card zab">
                    <div class="logo">ğŸ˜</div>
                    <h4><span class="tag zab">ZAB</span> æ¨¡ç³Šå¿«ç…§</h4>
                    <p><strong>ç›®çš„ï¼š</strong>æ•°æ®æŒä¹…åŒ–å’ŒèŠ‚ç‚¹æ¢å¤</p>
                    <p><strong>å†…å®¹ï¼š</strong>DataTree çŠ¶æ€ + æœ€åå¤„ç†çš„ zxid</p>
                    <p><strong>è§¦å‘ï¼š</strong>å®šæœŸæˆ–äº‹åŠ¡æ•°è¾¾åˆ°é˜ˆå€¼</p>
                    <p><strong>ç‰¹ç‚¹ï¼š</strong>æ¨¡ç³Šå¿«ç…§ï¼ˆFuzzy Snapshotï¼‰ï¼Œå…è®¸å¹¶å‘ä¿®æ”¹</p>
                </div>
            </div>

            <h3>3.1 å¿«ç…§åœ¨ä¸åŒåè®®ä¸­çš„è§’è‰²</h3>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>åè®®</th>
                        <th>å¿«ç…§ç±»å‹</th>
                        <th>ä¸»è¦ç”¨é€”</th>
                        <th>ä¸€è‡´æ€§ä¿è¯</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="tag raft">Raft</span></td>
                        <td>å®Œæ•´çŠ¶æ€å¿«ç…§</td>
                        <td>æ—¥å¿—å‹ç¼©ã€èŠ‚ç‚¹è¿½èµ¶</td>
                        <td>å¼ºä¸€è‡´æ€§ï¼ˆå·²æäº¤çš„æ—¥å¿—ï¼‰</td>
                    </tr>
                    <tr>
                        <td><span class="tag craq">CRAQ</span></td>
                        <td>å…ƒæ•°æ®å¿«ç…§ + å¢é‡æ•°æ®</td>
                        <td>æ–°èŠ‚ç‚¹åŒæ­¥ã€æ•…éšœæ¢å¤</td>
                        <td>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆé“¾å¤åˆ¶ä¿è¯ï¼‰</td>
                    </tr>
                    <tr>
                        <td><span class="tag zab">ZAB</span></td>
                        <td>æ¨¡ç³Šå¿«ç…§</td>
                        <td>æŒä¹…åŒ–ã€Leader é€‰ä¸¾ååŒæ­¥</td>
                        <td>é¡ºåºä¸€è‡´æ€§</td>
                    </tr>
                    <tr>
                        <td><span class="tag paxos">Multi-Paxos</span></td>
                        <td>æ£€æŸ¥ç‚¹å¿«ç…§</td>
                        <td>æ—¥å¿—æˆªæ–­ã€çŠ¶æ€æ¢å¤</td>
                        <td>çº¿æ€§ä¸€è‡´æ€§</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Section 4: Raft Snapshot -->
        <section id="raft" class="section">
            <h2>ğŸ—³ï¸ å››ã€Raft åè®®ä¸­çš„å¿«ç…§</h2>

            <div class="quote">
                <p>"Without snapshotting, Raft's log will grow without bound... Snapshotting is the simplest approach to compaction."</p>
                <div class="source">â€” Diego Ongaro, "In Search of an Understandable Consensus Algorithm" (Raft è®ºæ–‡)</div>
            </div>

            <h3>4.1 Raft å¿«ç…§çš„ç»“æ„</h3>

            <pre data-lang="Raft Snapshot Structure">
<span class="comment">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="comment">â”‚                    Raft Snapshot ç»“æ„                        â”‚</span>
<span class="comment">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="comment">â”‚                                                              â”‚</span>
<span class="comment">â”‚   lastIncludedIndex: å¿«ç…§åŒ…å«çš„æœ€åä¸€æ¡æ—¥å¿—çš„ç´¢å¼•            â”‚</span>
<span class="comment">â”‚   lastIncludedTerm:  è¯¥æ—¥å¿—æ¡ç›®çš„ä»»æœŸå·                      â”‚</span>
<span class="comment">â”‚   data:              çŠ¶æ€æœºçš„åºåˆ—åŒ–çŠ¶æ€                      â”‚</span>
<span class="comment">â”‚   configuration:     é›†ç¾¤é…ç½®ï¼ˆå¯é€‰ï¼‰                        â”‚</span>
<span class="comment">â”‚                                                              â”‚</span>
<span class="comment">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="comment">æ—¥å¿—ä¸å¿«ç…§çš„å…³ç³»ï¼š</span>

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                        æ—¥å¿—                              â”‚
   â”œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¤
   â”‚  1  â”‚  2  â”‚  3  â”‚  4  â”‚  5  â”‚  6  â”‚  7  â”‚  8  â”‚  9  â”‚...â”‚
   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜
         â†‘                       â†‘
         â”‚                       â”‚
   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚     å¿«ç…§è¦†ç›–çš„æ—¥å¿—èŒƒå›´
   â”‚
   â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚         Snapshot            â”‚
   â”‚  lastIncludedIndex = 5      â”‚
   â”‚  lastIncludedTerm = 2       â”‚
   â”‚  data = çŠ¶æ€æœºçŠ¶æ€          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>

            <h3>4.2 InstallSnapshot RPC</h3>

            <div class="info-box warning">
                <h4>âš ï¸ ä½¿ç”¨åœºæ™¯</h4>
                <p>å½“ Follower è½åå¤ªå¤šï¼ŒLeader å·²ç»ä¸¢å¼ƒäº† Follower éœ€è¦çš„æ—¥å¿—æ—¶ï¼ŒLeader é€šè¿‡ <code>InstallSnapshot RPC</code> å‘é€å¿«ç…§ã€‚</p>
            </div>

            <pre data-lang="Go-like Pseudocode">
<span class="keyword">type</span> <span class="type">InstallSnapshotArgs</span> <span class="keyword">struct</span> {
    Term              <span class="type">int</span>      <span class="comment">// Leader çš„ä»»æœŸ</span>
    LeaderId          <span class="type">int</span>      <span class="comment">// Leader ID</span>
    LastIncludedIndex <span class="type">int</span>      <span class="comment">// å¿«ç…§æœ€ååŒ…å«çš„æ—¥å¿—ç´¢å¼•</span>
    LastIncludedTerm  <span class="type">int</span>      <span class="comment">// è¯¥ç´¢å¼•å¯¹åº”çš„ä»»æœŸ</span>
    Offset            <span class="type">int</span>      <span class="comment">// åˆ†å—ä¼ è¾“çš„åç§»é‡</span>
    Data              []<span class="type">byte</span>   <span class="comment">// å¿«ç…§æ•°æ®å—</span>
    Done              <span class="type">bool</span>     <span class="comment">// æ˜¯å¦æ˜¯æœ€åä¸€å—</span>
}

<span class="keyword">func</span> (<span class="variable">rf</span> *<span class="type">Raft</span>) <span class="function">InstallSnapshot</span>(<span class="variable">args</span> *<span class="type">InstallSnapshotArgs</span>, <span class="variable">reply</span> *<span class="type">InstallSnapshotReply</span>) {
    <span class="comment">// 1. æ£€æŸ¥ä»»æœŸ</span>
    <span class="keyword">if</span> <span class="variable">args</span>.Term < <span class="variable">rf</span>.currentTerm {
        <span class="variable">reply</span>.Term = <span class="variable">rf</span>.currentTerm
        <span class="keyword">return</span>
    }
    
    <span class="comment">// 2. ä¿å­˜å¿«ç…§æ•°æ®</span>
    <span class="variable">rf</span>.<span class="function">saveSnapshot</span>(<span class="variable">args</span>.Data)
    
    <span class="comment">// 3. ä¸¢å¼ƒæ—§æ—¥å¿—</span>
    <span class="variable">rf</span>.<span class="function">trimLog</span>(<span class="variable">args</span>.LastIncludedIndex, <span class="variable">args</span>.LastIncludedTerm)
    
    <span class="comment">// 4. é‡ç½®çŠ¶æ€æœº</span>
    <span class="variable">rf</span>.<span class="function">applySnapshot</span>(<span class="variable">args</span>.Data)
}
            </pre>

            <h3>4.3 Raft å¿«ç…§çš„è§¦å‘æ¡ä»¶</h3>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="icon">ğŸ“</div>
                    <h4>æ—¥å¿—å¤§å°é˜ˆå€¼</h4>
                    <p>å½“æ—¥å¿—å¤§å°è¶…è¿‡é…ç½®çš„é˜ˆå€¼ï¼ˆå¦‚ 10MBï¼‰æ—¶ï¼Œè‡ªåŠ¨è§¦å‘å¿«ç…§åˆ›å»ºã€‚</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ”¢</div>
                    <h4>æ—¥å¿—æ¡ç›®æ•°é‡</h4>
                    <p>å½“æ—¥å¿—æ¡ç›®æ•°é‡è¶…è¿‡é˜ˆå€¼ï¼ˆå¦‚ 10000 æ¡ï¼‰æ—¶è§¦å‘ã€‚</p>
                </div>
                <div class="feature-card">
                    <div class="icon">â°</div>
                    <h4>å®šæ—¶è§¦å‘</h4>
                    <p>æŸäº›å®ç°æ”¯æŒå®šæ—¶åˆ›å»ºå¿«ç…§ï¼Œå¦‚æ¯å°æ—¶ä¸€æ¬¡ã€‚</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ“¤</div>
                    <h4>Follower è½å</h4>
                    <p>å½“ Follower éœ€è¦çš„æ—¥å¿—å·²è¢« Leader ä¸¢å¼ƒæ—¶ï¼Œè§¦å‘å¿«ç…§ä¼ è¾“ã€‚</p>
                </div>
            </div>
        </section>

        <!-- Section 5: CRAQ Snapshot -->
        <section id="craq" class="section">
            <h2>â›“ï¸ äº”ã€CRAQ åè®®ä¸­çš„å¿«ç…§</h2>

            <div class="quote">
                <p>"CRAQ extends chain replication to allow read operations on any node while maintaining strong consistency for writes."</p>
                <div class="source">â€” Jeff Terrace & Michael J. Freedman, "Object Storage on CRAQ" (CRAQ è®ºæ–‡)</div>
            </div>

            <h3>5.1 CRAQ å¿«ç…§çš„ç‹¬ç‰¹è®¾è®¡</h3>

            <div class="info-box concept">
                <h4>ğŸ’¡ æ ¸å¿ƒåŒºåˆ«</h4>
                <p>ä¸ Raft çš„"å®Œæ•´çŠ¶æ€å¿«ç…§"ä¸åŒï¼ŒCRAQ ä½¿ç”¨<strong>è½»é‡çº§å…ƒæ•°æ®å¿«ç…§</strong>é…åˆ<strong>å¢é‡æ•°æ®ä¼ è¾“</strong>ï¼š</p>
                <ul>
                    <li><strong>å¿«ç…§æœ¬èº«åªåŒ…å«å…ƒæ•°æ®</strong>ï¼šæ—¶é—´æˆ³ + å¯¹è±¡ç´¢å¼•åˆ—è¡¨</li>
                    <li><strong>å®é™…æ•°æ®æŒ‰éœ€ä¼ è¾“</strong>ï¼šåªä¼ è¾“å¿«ç…§è¾¹ç•Œä¹‹åçš„å¢é‡æ•°æ®</li>
                    <li><strong>å¯¹è±¡çº§ç²’åº¦</strong>ï¼šæ¯ä¸ªå¯¹è±¡ç‹¬ç«‹è¿½è¸ªåŒæ­¥è¿›åº¦</li>
                </ul>
            </div>

            <h3>5.2 CRAQ å¿«ç…§æ•°æ®ç»“æ„</h3>

            <div class="erlang-struct">
                <h4>ğŸ“¦ Erlang æ•°æ®ç»“æ„å®šä¹‰</h4>
                <pre data-lang="Erlang">
<span class="comment">%% å¿«ç…§ç»“æ„ï¼š{Timestamp, DataIndexList}</span>
<span class="variable">Snapshot</span> = {<span class="variable">Timestamp</span>, <span class="variable">DataIndexList</span|}

<span class="comment">%% Timestamp: æœ€æ–°å¤„ç†çš„äº‹åŠ¡IDï¼ˆå•è°ƒé€’å¢ï¼‰</span>
<span class="variable">Timestamp</span> :: <span class="type">non_neg_integer</span>()

<span class="comment">%% DataIndexList: æ¯ä¸ªå¯¹è±¡çš„æœ€æ–°æ•°æ®ç´¢å¼•</span>
<span class="variable">DataIndexList</span> = [{{<span class="variable">ObjectType</span>, <span class="variable">ObjectId</span>}, <span class="variable">DataIndex</span>}, ...]

<span class="comment">%% ç¤ºä¾‹</span>
{<span class="number">200</span>, [
    {{<span class="atom">person</span>, <span class="number">10</span>}, <span class="number">5</span>},   <span class="comment">%% person:10 å·²åŒæ­¥åˆ° data_index=5</span>
    {{<span class="atom">user</span>, <span class="number">3</span>}, <span class="number">2</span>},     <span class="comment">%% user:3 å·²åŒæ­¥åˆ° data_index=2</span>
    {{<span class="atom">order</span>, <span class="number">1</span>}, <span class="number">3</span|}    <span class="comment">%% order:1 å·²åŒæ­¥åˆ° data_index=3</span>
]}
                </pre>
            </div>

            <h3>5.3 CRAQ å¿«ç…§åŒæ­¥æµç¨‹</h3>

            <div class="flow-diagram">
                <pre>
<span class="comment">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="comment">â”‚                    CRAQ æ–°èŠ‚ç‚¹åŠ å…¥çš„å¿«ç…§åŒæ­¥æµç¨‹                          â”‚</span>
<span class="comment">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

   æ–°èŠ‚ç‚¹ (Node4)                  ç°æœ‰èŠ‚ç‚¹ (Node2)                  é“¾
        â”‚                              â”‚                            â”‚
        â”‚  1. è¯·æ±‚åŠ å…¥                  â”‚                            â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                            â”‚
        â”‚                              â”‚                            â”‚
        â”‚  2. è¿”å›å¿«ç…§å…ƒæ•°æ®            â”‚                            â”‚
        â”‚  {200, [{{person,10},5},...]}â”‚                            â”‚
        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
        â”‚                              â”‚                            â”‚
        â”‚  3. æ ¹æ®å¿«ç…§è¿‡æ»¤å¢é‡æ•°æ®       â”‚                            â”‚
        â”‚  (timestamp > 200 çš„æ•°æ®)    â”‚                            â”‚
        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
        â”‚                              â”‚                            â”‚
        â”‚  4. åº”ç”¨å¢é‡æ•°æ®              â”‚                            â”‚
        â”‚  merge_data(...)             â”‚                            â”‚
        â”‚                              â”‚                            â”‚
        â”‚  5. çŠ¶æ€è½¬æ¢: READY           â”‚                            â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                              â”‚                            â”‚
        â”‚           æ­£å¸¸å‚ä¸é“¾å¤åˆ¶       â”‚                            â”‚
        â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚


<span class="keyword">æ•°æ®è¿‡æ»¤è§„åˆ™ï¼š</span>

    if (data.timestamp > snapshot.timestamp):
        include(data)  <span class="comment">// æ–°äº‹åŠ¡çš„æ•°æ®</span>
    
    elif (data.timestamp == snapshot.timestamp):
        if (data.data_index > snapshot.data_index_for_object):
            include(data)  <span class="comment">// åŒäº‹åŠ¡ä½†æ›´æ–°çš„æ•°æ®</span>
        else:
            skip(data)  <span class="comment">// å·²åŒæ­¥çš„æ•°æ®</span>
    
    else:
        skip(data)  <span class="comment">// æ—§äº‹åŠ¡çš„æ•°æ®</span>
                </pre>
            </div>

            <h3>5.4 ä¸ºä»€ä¹ˆ CRAQ éœ€è¦ data_indexï¼Ÿ</h3>

            <div class="info-box warning">
                <h4>âš ï¸ é—®é¢˜åœºæ™¯</h4>
                <p>åŒä¸€æ—¶é—´æˆ³ï¼ˆäº‹åŠ¡ï¼‰å†…å¯èƒ½æœ‰å¤šæ¬¡æ“ä½œä½œç”¨äºåŒä¸€å¯¹è±¡ï¼š</p>
            </div>

            <pre data-lang="Erlang">
<span class="comment">%% äº‹åŠ¡ 100 å†…å¯¹ person:10 çš„ä¸‰ä¸ªæ“ä½œ</span>
<span class="variable">UpdateList</span> = [
    {<span class="atom">person</span>, <span class="number">10</span>, [{<span class="atom">name</span>, <span class="atom">active</span>, <span class="string">"john"</span>}]},   <span class="comment">%% data_index=1</span>
    {<span class="atom">person</span>, <span class="number">10</span>, [{<span class="atom">age</span>, <span class="atom">active</span>, <span class="number">25</span>}]},        <span class="comment">%% data_index=2</span>
    {<span class="atom">person</span>, <span class="number">10</span>, [{<span class="atom">city</span>, <span class="atom">active</span>, <span class="string">"beijing"</span>}]} <span class="comment">%% data_index=3</span>
]

<span class="comment">%% å¦‚æœåªç”¨ timestampï¼Œæ— æ³•åŒºåˆ†è¿™ä¸‰ä¸ªæ“ä½œ</span>
<span class="comment">%% data_index æä¾›äº†äº‹åŠ¡å†…çš„æ“ä½œé¡ºåº</span>

<span class="comment">%% å¿«ç…§è®°å½•ï¼š</span>
{<span class="number">100</span>, [{{<span class="atom">person</span>, <span class="number">10</span>}, <span class="number">2</span>}]}  <span class="comment">%% å·²åŒæ­¥åˆ°ç¬¬ 2 ä¸ªæ“ä½œ</span>

<span class="comment">%% è¿‡æ»¤ç»“æœï¼š</span>
<span class="comment">%% - data_index=1: è·³è¿‡ï¼ˆâ‰¤ 2ï¼‰</span>
<span class="comment">%% - data_index=2: è·³è¿‡ï¼ˆâ‰¤ 2ï¼‰</span>
<span class="comment">%% - data_index=3: åŒ…å«ï¼ˆ> 2ï¼‰âœ“</span>
            </pre>
        </section>

        <!-- Section 6: Erlang Implementation -->
        <section id="erlang" class="section">
            <h2>ğŸ’» å…­ã€æœ¬é¡¹ç›®çš„ Erlang å®ç°</h2>

            <h3>6.1 æ ¸å¿ƒæ•°æ®ç»“æ„</h3>

            <pre data-lang="Erlang">
<span class="comment">%% æ–‡ä»¶: include/erlang_craq.hrl</span>

<span class="comment">%% æ•°æ®çŠ¶æ€è®°å½•ï¼ˆåŒ…å«å¿«ç…§ä¿¡æ¯ï¼‰</span>
<span class="keyword">-record</span>(<span class="atom">eh_data_state</span>, {
    <span class="atom">timestamp</span>=<span class="number">0</span>                 :: <span class="type">non_neg_integer</span>(),  <span class="comment">%% å½“å‰æ—¶é—´æˆ³</span>
    <span class="atom">transient_timestamp</span>=<span class="number">0</span>       :: <span class="type">non_neg_integer</span>(),  <span class="comment">%% ä¸´æ—¶æ—¶é—´æˆ³</span>
    <span class="atom">data_index_list</span>=[]          :: <span class="type">list</span>(),             <span class="comment">%% å¯¹è±¡ç´¢å¼•åˆ—è¡¨</span>
    <span class="atom">data</span>=<span class="function">maps:new</span>()             :: <span class="type">maps:map</span>(),          <span class="comment">%% å®é™…æ•°æ®</span>
    <span class="atom">transient_data</span>=<span class="function">queue:new</span>()  :: <span class="type">queue:queue</span>(),      <span class="comment">%% ä¸´æ—¶æ•°æ®é˜Ÿåˆ—</span>
    <span class="atom">data_update_count</span>=<span class="number">0</span>         :: <span class="type">non_neg_integer</span>(),  <span class="comment">%% æ›´æ–°è®¡æ•°</span>
    <span class="atom">file_version_num</span>=<span class="number">0</span>          :: <span class="type">non_neg_integer</span>(),  <span class="comment">%% æ–‡ä»¶ç‰ˆæœ¬</span>
    <span class="atom">file</span>                        :: <span class="type">file:io_device</span>(),   <span class="comment">%% æ–‡ä»¶å¥æŸ„</span>
    <span class="atom">app_config</span>                  :: #<span class="atom">eh_app_config</span>{}    <span class="comment">%% åº”ç”¨é…ç½®</span>
}).

<span class="comment">%% èŠ‚ç‚¹çŠ¶æ€ï¼ˆå¿«ç…§ç›¸å…³ï¼‰</span>
<span class="keyword">-define</span>(<span class="atom">EH_NOT_READY</span>,     <span class="atom">eh_not_ready</span>).           <span class="comment">%% åˆå§‹çŠ¶æ€</span>
<span class="keyword">-define</span>(<span class="atom">EH_TRANSIENT</span>,     <span class="atom">eh_transient</span>).           <span class="comment">%% ç­‰å¾…å¿«ç…§</span>
<span class="keyword">-define</span>(<span class="atom">EH_TRANSIENT_DU</span>,  <span class="atom">eh_transient_data_updated</span>).  <span class="comment">%% æ•°æ®å·²æ›´æ–°</span>
<span class="keyword">-define</span>(<span class="atom">EH_TRANSIENT_TU</span>,  <span class="atom">eh_transient_timestamp_updated</span>).  <span class="comment">%% æ—¶é—´æˆ³å·²æ›´æ–°</span>
<span class="keyword">-define</span>(<span class="atom">EH_READY</span>,         <span class="atom">eh_ready</span>).               <span class="comment">%% å°±ç»ª</span>
            </pre>

            <h3>6.2 å¿«ç…§è¯·æ±‚å¤„ç†</h3>

            <pre data-lang="Erlang">
<span class="comment">%% æ–‡ä»¶: src/eh_system_server.erl</span>

<span class="comment">%% å¤„ç†å¿«ç…§è¯·æ±‚</span>
<span class="function">process_snapshot_request</span>(<span class="variable">NodeList</span>, <span class="variable">NodeOrderList</span>, <span class="variable">Succ</span>, 
                         #<span class="atom">eh_system_state</span>{<span class="atom">app_config</span>=<span class="variable">AppConfig</span|}=<span class="variable">State</span>) <span class="operator">-></span>
    <span class="variable">NodeId</span> = <span class="function">eh_system_config:get_node_id</span>(<span class="variable">AppConfig</span>),
    <span class="variable">UniqueIdGenerator</span> = <span class="function">eh_system_config:get_unique_id_generator</span>(<span class="variable">AppConfig</span>),
    <span class="variable">ReplDataManager</span> = <span class="function">eh_system_config:get_repl_data_manager</span>(<span class="variable">AppConfig</span>),
    
    <span class="comment">%% ç”Ÿæˆå”¯ä¸€çš„å¿«ç…§å¼•ç”¨</span>
    <span class="variable">SnapshotRef</span> = <span class="variable">UniqueIdGenerator</span>:<span class="function">unique_id</span>(),
    
    <span class="comment">%% è·å–å½“å‰å¿«ç…§ï¼š{Timestamp, DataIndexList}</span>
    {<span class="variable">Timestamp</span>, <span class="variable">Snapshot</span>} = <span class="variable">ReplDataManager</span>:<span class="function">timestamp</span>(),
    
    <span class="comment">%% å‘åç»§èŠ‚ç‚¹å‘é€å¿«ç…§è¯·æ±‚</span>
    <span class="function">gen_server:cast</span>(
        {<span class="atom">?EH_SYSTEM_SERVER</span>, <span class="variable">Succ</span>}, 
        {<span class="atom">?EH_SNAPSHOT</span>, {<span class="variable">NodeId</span>, <span class="variable">NodeList</span>, <span class="variable">NodeOrderList</span>, <span class="variable">SnapshotRef</span>, {<span class="variable">Timestamp</span>, <span class="variable">Snapshot</span|}}}
    ),
    
    <span class="variable">State</span>#<span class="atom">eh_system_state</span>{<span class="atom">snapshot_ref</span>=<span class="variable">SnapshotRef</span>}.
            </pre>

            <h3>6.3 å¿«ç…§æ•°æ®è¿‡æ»¤</h3>

            <pre data-lang="Erlang">
<span class="comment">%% æ–‡ä»¶: src/eh_data_util.erl</span>

<span class="comment">%% å¿«ç…§è¿‡æ»¤å‡½æ•°ï¼šå†³å®šå“ªäº›æ•°æ®éœ€è¦å‘é€ç»™æ–°èŠ‚ç‚¹</span>

<span class="comment">%% æƒ…å†µ1ï¼šæ•°æ®æ—¶é—´æˆ³ > å¿«ç…§æ—¶é—´æˆ³ â†’ åŒ…å«</span>
<span class="function">snapshot_fun</span>({<span class="variable">CTimestamp</span>, <span class="variable">_CDataIndexList</span>, <span class="variable">StorageKey</span>}, 
             #<span class="atom">eh_storage_value</span>{<span class="atom">timestamp</span>=<span class="variable">Timestamp</span>}=<span class="variable">StorageValue</span>, <span class="variable">Qo0</span>) 
  <span class="keyword">when</span> <span class="variable">Timestamp</span> <span class="operator">></span> <span class="variable">CTimestamp</span> <span class="operator">-></span>
    [<span class="function">storage_data</span>(<span class="variable">StorageKey</span>, <span class="variable">StorageValue</span>) | <span class="variable">Qo0</span>];

<span class="comment">%% æƒ…å†µ2ï¼šæ•°æ®æ—¶é—´æˆ³ = å¿«ç…§æ—¶é—´æˆ³ â†’ æ¯”è¾ƒ data_index</span>
<span class="function">snapshot_fun</span>({<span class="variable">CTimestamp</span>, <span class="variable">CDataIndexList</span>, 
              #<span class="atom">eh_storage_key</span>{<span class="atom">object_type</span>=<span class="variable">ObjectType</span>, <span class="atom">object_id</span>=<span class="variable">ObjectId</span>}=<span class="variable">StorageKey</span>},
             #<span class="atom">eh_storage_value</span>{<span class="atom">timestamp</span>=<span class="variable">Timestamp</span>, <span class="atom">data_index</span>=<span class="variable">DataIndex</span>}=<span class="variable">StorageValue</span>, <span class="variable">Qo0</span>)
  <span class="keyword">when</span> <span class="variable">Timestamp</span> <span class="operator">=:=</span> <span class="variable">CTimestamp</span> <span class="operator">-></span>
    <span class="keyword">case</span> <span class="function">lists:keyfind</span>({<span class="variable">ObjectType</span>, <span class="variable">ObjectId</span>}, <span class="number">1</span>, <span class="variable">CDataIndexList</span>) <span class="keyword">of</span>
        <span class="atom">false</span> <span class="operator">-></span>
            <span class="comment">%% æ–°å¯¹è±¡ï¼ŒåŒ…å«</span>
            [<span class="function">storage_data</span>(<span class="variable">StorageKey</span>, <span class="variable">StorageValue</span>) | <span class="variable">Qo0</span>];
        {<span class="variable">_</span>, <span class="variable">CDataIndex</span>} <span class="keyword">when</span> <span class="variable">DataIndex</span> <span class="operator">></span> <span class="variable">CDataIndex</span> <span class="operator">-></span>
            <span class="comment">%% data_index æ›´å¤§ï¼ŒåŒ…å«</span>
            [<span class="function">storage_data</span>(<span class="variable">StorageKey</span>, <span class="variable">StorageValue</span>) | <span class="variable">Qo0</span>];
        <span class="variable">_</span> <span class="operator">-></span>
            <span class="comment">%% å·²åŒæ­¥ï¼Œè·³è¿‡</span>
            <span class="variable">Qo0</span>
    <span class="keyword">end</span>;

<span class="comment">%% æƒ…å†µ3ï¼šæ•°æ®æ—¶é—´æˆ³ < å¿«ç…§æ—¶é—´æˆ³ â†’ è·³è¿‡</span>
<span class="function">snapshot_fun</span>(<span class="variable">_</span>, <span class="variable">_</span>, <span class="variable">Qo0</span>) <span class="operator">-></span>
    <span class="variable">Qo0</span>.
            </pre>

            <h3>6.4 å¿«ç…§åº”ç”¨ä¸çŠ¶æ€è½¬æ¢</h3>

            <pre data-lang="Erlang">
<span class="comment">%% æ–‡ä»¶: src/eh_node_state.erl</span>

<span class="comment">%% å¿«ç…§æ›´æ–°åçš„çŠ¶æ€è½¬æ¢</span>
<span class="function">update_state_snapshot</span>(#<span class="atom">eh_system_state</span>{<span class="atom">node_status</span>=<span class="atom">?EH_TRANSIENT</span>}=<span class="variable">State</span>) <span class="operator">-></span>
    <span class="comment">%% ä» TRANSIENT è½¬æ¢åˆ° TRANSIENT_DU</span>
    <span class="function">update_state</span>(<span class="atom">?EH_TRANSIENT_DU</span>, <span class="variable">State</span>);

<span class="function">update_state_snapshot</span>(#<span class="atom">eh_system_state</span>{<span class="atom">node_status</span>=<span class="atom">?EH_TRANSIENT_TU</span>}=<span class="variable">State</span>) <span class="operator">-></span>
    <span class="comment">%% ä» TRANSIENT_TU è½¬æ¢åˆ° READY</span>
    <span class="function">update_state</span>(<span class="atom">?EH_READY</span>, <span class="variable">State</span>);

<span class="function">update_state_snapshot</span>(<span class="variable">State</span>) <span class="operator">-></span>
    <span class="comment">%% å…¶ä»–çŠ¶æ€ä¿æŒä¸å˜</span>
    <span class="variable">State</span>.

<span class="comment">%% çŠ¶æ€è½¬æ¢å›¾ï¼š</span>
<span class="comment">%%</span>
<span class="comment">%%   NOT_READY</span>
<span class="comment">%%       â”‚</span>
<span class="comment">%%       â†“ (åŠ å…¥é›†ç¾¤)</span>
<span class="comment">%%   TRANSIENT</span>
<span class="comment">%%       â”‚</span>
<span class="comment">%%       â†“ (æ”¶åˆ°å¿«ç…§)</span>
<span class="comment">%%   TRANSIENT_DU</span>
<span class="comment">%%       â”‚</span>
<span class="comment">%%       â†“ (æ•°æ®åˆå¹¶å®Œæˆ)</span>
<span class="comment">%%   TRANSIENT_TU</span>
<span class="comment">%%       â”‚</span>
<span class="comment">%%       â†“ (çŠ¶æ€æ›´æ–°å®Œæˆ)</span>
<span class="comment">%%   READY</span>
            </pre>
        </section>

        <!-- Section 7: Scenarios -->
        <section id="scenarios" class="section">
            <h2>ğŸ¯ ä¸ƒã€å¿«ç…§çš„åº”ç”¨åœºæ™¯</h2>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="icon">ğŸ†•</div>
                    <h4>æ–°èŠ‚ç‚¹åŠ å…¥</h4>
                    <p>æ–°èŠ‚ç‚¹é€šè¿‡å¿«ç…§å¿«é€Ÿè·å–ç³»ç»Ÿå½“å‰çŠ¶æ€ï¼Œæ— éœ€é‡æ”¾å…¨éƒ¨å†å²æ—¥å¿—ã€‚</p>
                    <ul>
                        <li>Raft: InstallSnapshot RPC</li>
                        <li>CRAQ: å…ƒæ•°æ®å¿«ç…§ + å¢é‡åŒæ­¥</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ’¥</div>
                    <h4>æ•…éšœæ¢å¤</h4>
                    <p>èŠ‚ç‚¹å´©æºƒåä»æœ€è¿‘çš„å¿«ç…§æ¢å¤ï¼Œç„¶åé‡æ”¾åç»­æ—¥å¿—ã€‚</p>
                    <ul>
                        <li>å‡å°‘æ¢å¤æ—¶é—´</li>
                        <li>é™ä½æ—¥å¿—å­˜å‚¨å‹åŠ›</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ“¦</div>
                    <h4>æ—¥å¿—å‹ç¼©</h4>
                    <p>å®šæœŸåˆ›å»ºå¿«ç…§ï¼Œä¸¢å¼ƒå¿«ç…§ä¹‹å‰çš„æ—¥å¿—ï¼Œé˜²æ­¢æ—¥å¿—æ— é™å¢é•¿ã€‚</p>
                    <ul>
                        <li>Raft: æ—¥å¿—æˆªæ–­</li>
                        <li>ZooKeeper: äº‹åŠ¡æ—¥å¿—æ¸…ç†</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ”„</div>
                    <h4>æ•°æ®è¿ç§»</h4>
                    <p>é›†ç¾¤æ‰©å®¹æˆ–æ•°æ®é‡æ–°åˆ†ç‰‡æ—¶ï¼Œé€šè¿‡å¿«ç…§ä¼ è¾“æ•°æ®ã€‚</p>
                    <ul>
                        <li>åˆ†ç‰‡è¿ç§»</li>
                        <li>è·¨æ•°æ®ä¸­å¿ƒå¤åˆ¶</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ“Š</div>
                    <h4>å¤‡ä»½ä¸å®¡è®¡</h4>
                    <p>å®šæœŸå¿«ç…§ç”¨äºæ•°æ®å¤‡ä»½å’Œåˆè§„å®¡è®¡ã€‚</p>
                    <ul>
                        <li>æ—¶é—´ç‚¹æ¢å¤ (PITR)</li>
                        <li>å†å²æ•°æ®åˆ†æ</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ§ª</div>
                    <h4>æµ‹è¯•ä¸è°ƒè¯•</h4>
                    <p>ä½¿ç”¨å¿«ç…§åˆ›å»ºç³»ç»ŸçŠ¶æ€çš„å‰¯æœ¬ç”¨äºæµ‹è¯•ã€‚</p>
                    <ul>
                        <li>é—®é¢˜å¤ç°</li>
                        <li>æ€§èƒ½æµ‹è¯•</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 8: Comparison -->
        <section id="comparison" class="section">
            <h2>âš–ï¸ å…«ã€å¿«ç…§æœºåˆ¶å¯¹æ¯”</h2>

            <h3>8.1 Raft vs CRAQ å¿«ç…§å¯¹æ¯”</h3>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>ç‰¹æ€§</th>
                        <th>Raft å¿«ç…§</th>
                        <th>CRAQ å¿«ç…§</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>å¿«ç…§å†…å®¹</strong></td>
                        <td>å®Œæ•´çŠ¶æ€æœºçŠ¶æ€</td>
                        <td>å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ + ç´¢å¼•åˆ—è¡¨ï¼‰</td>
                    </tr>
                    <tr>
                        <td><strong>å¿«ç…§å¤§å°</strong></td>
                        <td>ä¸æ•°æ®é‡æˆæ­£æ¯”ï¼Œå¯èƒ½å¾ˆå¤§</td>
                        <td>è½»é‡çº§ï¼Œåªæœ‰å…ƒæ•°æ®</td>
                    </tr>
                    <tr>
                        <td><strong>æ•°æ®ä¼ è¾“</strong></td>
                        <td>å¿«ç…§åŒ…å«å…¨éƒ¨æ•°æ®</td>
                        <td>å¿«ç…§ + å¢é‡æ•°æ®åˆ†å¼€ä¼ è¾“</td>
                    </tr>
                    <tr>
                        <td><strong>ç²’åº¦</strong></td>
                        <td>å…¨å±€ç²’åº¦</td>
                        <td>å¯¹è±¡çº§ç²’åº¦ï¼ˆdata_indexï¼‰</td>
                    </tr>
                    <tr>
                        <td><strong>ä¸»è¦ç”¨é€”</strong></td>
                        <td>æ—¥å¿—å‹ç¼©ã€Follower è¿½èµ¶</td>
                        <td>æ–°èŠ‚ç‚¹åŒæ­¥ã€æ•…éšœæ¢å¤</td>
                    </tr>
                    <tr>
                        <td><strong>åˆ›å»ºæ—¶æœº</strong></td>
                        <td>æ—¥å¿—è¾¾åˆ°é˜ˆå€¼æ—¶</td>
                        <td>æ–°èŠ‚ç‚¹åŠ å…¥æ—¶æŒ‰éœ€åˆ›å»º</td>
                    </tr>
                    <tr>
                        <td><strong>ä¸€è‡´æ€§</strong></td>
                        <td>å¼ºä¸€è‡´æ€§ï¼ˆå·²æäº¤æ—¥å¿—ï¼‰</td>
                        <td>æœ€ç»ˆä¸€è‡´æ€§ï¼ˆé“¾å¤åˆ¶ä¿è¯ï¼‰</td>
                    </tr>
                </tbody>
            </table>

            <h3>8.2 å¿«ç…§çš„æƒè¡¡</h3>

            <div class="info-box warning">
                <h4>âš–ï¸ è®¾è®¡æƒè¡¡</h4>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>æƒè¡¡ç‚¹</th>
                            <th>é€‰æ‹© A</th>
                            <th>é€‰æ‹© B</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>å¿«ç…§é¢‘ç‡</strong></td>
                            <td>é¢‘ç¹ï¼šæ¢å¤å¿«ï¼Œä½† I/O å¼€é”€å¤§</td>
                            <td>ç¨€ç–ï¼šI/O å°‘ï¼Œä½†æ¢å¤æ…¢</td>
                        </tr>
                        <tr>
                            <td><strong>å¿«ç…§ç²’åº¦</strong></td>
                            <td>å…¨é‡ï¼šç®€å•ï¼Œä½†ä¼ è¾“å¤§</td>
                            <td>å¢é‡ï¼šé«˜æ•ˆï¼Œä½†å®ç°å¤æ‚</td>
                        </tr>
                        <tr>
                            <td><strong>å¿«ç…§æ—¶æœº</strong></td>
                            <td>åŒæ­¥ï¼šä¸€è‡´æ€§å¥½ï¼Œä½†é˜»å¡</td>
                            <td>å¼‚æ­¥ï¼šä¸é˜»å¡ï¼Œä½†ä¸€è‡´æ€§å¤æ‚</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>8.3 å„åè®®å¿«ç…§ç‰¹æ€§æ€»ç»“</h3>

            <div class="flow-diagram">
                <pre>
<span class="comment">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="comment">â”‚                        å¿«ç…§ç‰¹æ€§å¯¹æ¯”çŸ©é˜µ                                   â”‚</span>
<span class="comment">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="comment">â”‚                                                                          â”‚</span>
<span class="comment">â”‚                    å®Œæ•´æ€§                                                â”‚</span>
<span class="comment">â”‚                      â†‘                                                   â”‚</span>
<span class="comment">â”‚                      â”‚                                                   â”‚</span>
<span class="comment">â”‚              Raft â—  â”‚                                                   â”‚</span>
<span class="comment">â”‚                      â”‚  â— ZAB                                           â”‚</span>
<span class="comment">â”‚                      â”‚                                                   â”‚</span>
<span class="comment">â”‚                      â”‚        â— Paxos                                   â”‚</span>
<span class="comment">â”‚                      â”‚                                                   â”‚</span>
<span class="comment">â”‚                      â”‚                â— CRAQ                            â”‚</span>
<span class="comment">â”‚                      â”‚                                                   â”‚</span>
<span class="comment">â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ è½»é‡çº§         â”‚</span>
<span class="comment">â”‚                                                                          â”‚</span>
<span class="comment">â”‚  Raft:  å®Œæ•´çŠ¶æ€å¿«ç…§ï¼Œé€‚åˆæ—¥å¿—å‹ç¼©                                        â”‚</span>
<span class="comment">â”‚  ZAB:   æ¨¡ç³Šå¿«ç…§ï¼Œå…è®¸å¹¶å‘ä¿®æ”¹                                            â”‚</span>
<span class="comment">â”‚  Paxos: æ£€æŸ¥ç‚¹å¿«ç…§ï¼Œç”¨äºæ—¥å¿—æˆªæ–­                                          â”‚</span>
<span class="comment">â”‚  CRAQ:  å…ƒæ•°æ®å¿«ç…§ï¼Œé…åˆå¢é‡åŒæ­¥                                          â”‚</span>
<span class="comment">â”‚                                                                          â”‚</span>
<span class="comment">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
                </pre>
            </div>
        </section>

        <!-- Section 9: Summary -->
        <section id="summary" class="section">
            <h2>ğŸ“‹ ä¹ã€æ€»ç»“</h2>

            <h3>9.1 å¿«ç…§çš„æ ¸å¿ƒä»·å€¼</h3>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="icon">ğŸš€</div>
                    <h4>åŠ é€Ÿæ¢å¤</h4>
                    <p>ä»å¿«ç…§æ¢å¤æ¯”é‡æ”¾å…¨éƒ¨æ—¥å¿—å¿«å‡ ä¸ªæ•°é‡çº§</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ’¾</div>
                    <h4>èŠ‚çœå­˜å‚¨</h4>
                    <p>å…è®¸ä¸¢å¼ƒæ—§æ—¥å¿—ï¼Œé˜²æ­¢å­˜å‚¨æ— é™å¢é•¿</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ”—</div>
                    <h4>ç®€åŒ–åŒæ­¥</h4>
                    <p>æ–°èŠ‚ç‚¹åªéœ€å¿«ç…§ + å¢é‡ï¼Œæ— éœ€å…¨é‡å¤åˆ¶</p>
                </div>
                <div class="feature-card">
                    <div class="icon">ğŸ›¡ï¸</div>
                    <h4>æé«˜å¯é æ€§</h4>
                    <p>å¿«ç…§ä½œä¸ºæ£€æŸ¥ç‚¹ï¼Œå‡å°‘æ•°æ®ä¸¢å¤±é£é™©</p>
                </div>
            </div>

            <h3>9.2 å¿«ç…§è®¾è®¡è¦ç‚¹</h3>

            <div class="info-box concept">
                <h4>âœ… æœ€ä½³å®è·µ</h4>
                <ol>
                    <li><strong>é€‰æ‹©åˆé€‚çš„å¿«ç…§ç²’åº¦</strong>ï¼šæ ¹æ®æ•°æ®è§„æ¨¡å’Œæ›´æ–°é¢‘ç‡é€‰æ‹©å…¨é‡æˆ–å¢é‡</li>
                    <li><strong>è®¾ç½®åˆç†çš„è§¦å‘æ¡ä»¶</strong>ï¼šæ—¥å¿—å¤§å°ã€æ—¶é—´é—´éš”ã€äº‹åŠ¡æ•°é‡</li>
                    <li><strong>å¼‚æ­¥åˆ›å»ºå¿«ç…§</strong>ï¼šé¿å…é˜»å¡æ­£å¸¸è¯·æ±‚å¤„ç†</li>
                    <li><strong>å‹ç¼©å¿«ç…§æ•°æ®</strong>ï¼šå‡å°‘å­˜å‚¨å’Œä¼ è¾“å¼€é”€</li>
                    <li><strong>éªŒè¯å¿«ç…§å®Œæ•´æ€§</strong>ï¼šä½¿ç”¨æ ¡éªŒå’Œç¡®ä¿æ•°æ®æ­£ç¡®</li>
                    <li><strong>ä¿ç•™å¤šä¸ªå¿«ç…§</strong>ï¼šæ”¯æŒå›æ»šåˆ°ä¸åŒæ—¶é—´ç‚¹</li>
                </ol>
            </div>

            <h3>9.3 æœ¬é¡¹ç›® CRAQ å¿«ç…§çš„å…³é”®ç‚¹</h3>

            <pre data-lang="Summary">
<span class="comment">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="comment">â”‚                    CRAQ å¿«ç…§æœºåˆ¶è¦ç‚¹æ€»ç»“                                  â”‚</span>
<span class="comment">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="comment">â”‚                                                                          â”‚</span>
<span class="comment">â”‚  1. å¿«ç…§ç»“æ„: {Timestamp, DataIndexList}                                 â”‚</span>
<span class="comment">â”‚     - Timestamp: æœ€æ–°äº‹åŠ¡ID                                              â”‚</span>
<span class="comment">â”‚     - DataIndexList: [{{ObjectType, ObjectId}, DataIndex}, ...]        â”‚</span>
<span class="comment">â”‚                                                                          â”‚</span>
<span class="comment">â”‚  2. æ•°æ®è¿‡æ»¤è§„åˆ™:                                                         â”‚</span>
<span class="comment">â”‚     - timestamp > snapshot.timestamp â†’ åŒ…å«                             â”‚</span>
<span class="comment">â”‚     - timestamp = snapshot.timestamp AND data_index > snapshot â†’ åŒ…å«   â”‚</span>
<span class="comment">â”‚     - å…¶ä»– â†’ è·³è¿‡                                                        â”‚</span>
<span class="comment">â”‚                                                                          â”‚</span>
<span class="comment">â”‚  3. çŠ¶æ€è½¬æ¢:                                                             â”‚</span>
<span class="comment">â”‚     NOT_READY â†’ TRANSIENT â†’ TRANSIENT_DU â†’ TRANSIENT_TU â†’ READY         â”‚</span>
<span class="comment">â”‚                                                                          â”‚</span>
<span class="comment">â”‚  4. æ ¸å¿ƒæ–‡ä»¶:                                                             â”‚</span>
<span class="comment">â”‚     - eh_system_server.erl: å¿«ç…§è¯·æ±‚/å“åº”å¤„ç†                             â”‚</span>
<span class="comment">â”‚     - eh_data_util.erl: å¿«ç…§æ•°æ®è¿‡æ»¤                                      â”‚</span>
<span class="comment">â”‚     - eh_node_state.erl: çŠ¶æ€è½¬æ¢                                        â”‚</span>
<span class="comment">â”‚     - eh_data_server.erl: æ•°æ®å­˜å‚¨                                       â”‚</span>
<span class="comment">â”‚                                                                          â”‚</span>
<span class="comment">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
            </pre>

            <h3>9.4 å»¶ä¼¸é˜…è¯»</h3>

            <div class="info-box theory">
                <h4>ğŸ“š æ¨èè®ºæ–‡</h4>
                <ul>
                    <li><strong>Raft:</strong> "In Search of an Understandable Consensus Algorithm" - Diego Ongaro, 2014</li>
                    <li><strong>CRAQ:</strong> "Object Storage on CRAQ" - Jeff Terrace & Michael J. Freedman, 2009</li>
                    <li><strong>Chandy-Lamport:</strong> "Distributed Snapshots: Determining Global States of Distributed Systems" - 1985</li>
                    <li><strong>ZAB:</strong> "Zab: High-performance broadcast for primary-backup systems" - 2011</li>
                    <li><strong>Chain Replication:</strong> "Chain Replication for Supporting High Throughput and Availability" - 2004</li>
                </ul>
            </div>
        </section>

        <!-- Footer -->
        <footer style="text-align: center; padding: 3rem; color: var(--text-muted);">
            <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">åˆ†å¸ƒå¼ç³»ç»Ÿå¿«ç…§ (Snapshot) æ¦‚å¿µå…¨è§£</p>
            <p>ç»“åˆ Raftã€CRAQã€ZAB åè®®ä¸ Erlang å®ç°</p>
            <p style="margin-top: 1rem; font-size: 0.9rem;">ç”Ÿæˆæ—¶é—´: 2025-12-19</p>
        </footer>
    </div>

    <script>
        // Smooth scrolling
        document.querySelectorAll('.nav-toc a').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        // Highlight active section in nav
        const sections = document.querySelectorAll('.section');
        const navLinks = document.querySelectorAll('.nav-toc a');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.style.background = '';
                link.style.color = '';
                if (link.getAttribute('href') === '#' + current) {
                    link.style.background = 'var(--primary)';
                    link.style.color = 'white';
                }
            });
        });
    </script>

<!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="back-to-top" style="
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, #00d4ff, #7c3aed);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
    transition: all 0.3s ease;
    z-index: 999;
    opacity: 0;
    transform: translateY(20px);
" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
   onmouseover="this.style.transform='translateY(-5px) scale(1.1)'" 
   onmouseout="this.style.transform='translateY(0) scale(1)'">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
        <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
    </svg>
</div>

<script>
// å›åˆ°é¡¶éƒ¨æŒ‰é’®æ˜¾ç¤º/éšè—é€»è¾‘
window.addEventListener('scroll', function() {
    const backToTop = document.getElementById('back-to-top');
    if (window.scrollY > 300) {
        backToTop.style.opacity = '1';
        backToTop.style.transform = 'translateY(0)';
    } else {
        backToTop.style.opacity = '0';
        backToTop.style.transform = 'translateY(20px)';
    }
});
</script>

</body>
</html>
